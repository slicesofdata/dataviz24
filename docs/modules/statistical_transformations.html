<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gabriel I. Cook">
<meta name="dcterms.date" content="2024-10-31">

<title>Statistical transformations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://kit.fontawesome.com/78ddb093ea.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="../css/nav.css">
<link rel="stylesheet" href="../css/styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text"><strong>Home</strong></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../schedule/index.html" aria-current="page"> 
<span class="menu-text"><strong>Schedule</strong></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../modules/index.html"> 
<span class="menu-text"><strong>Modules</strong></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../project/index.html"> 
<span class="menu-text"><strong>Project</strong></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-slides" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text"><strong>Slides</strong></span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-slides">    
        <li>
    <a class="dropdown-item" href="../slides/01_intro_rstudio_rmarkdown_slides.html">
 <span class="dropdown-text">R, RStudio, &amp; R Markdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/02_git_slides.html">
 <span class="dropdown-text">Git and GitHub</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/03_functions_slides.html">
 <span class="dropdown-text">Functions, Parameters, and Arguments</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hw" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text"><strong>HW</strong></span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hw">    
        <li>
    <a class="dropdown-item" href="../homework/hw01.Rmd">
 <span class="dropdown-text">HW 01</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../homework/hw02.Rmd">
 <span class="dropdown-text">HW 02</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../homework/hw03.Rmd">
 <span class="dropdown-text">HW 03</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../homework/hw04.pdf">
 <span class="dropdown-text">HW 04</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../homework/hw05.pdf">
 <span class="dropdown-text">HW 05</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../homework/hw06.Rmd">
 <span class="dropdown-text">HW 06</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../homework/hw07.pdf">
 <span class="dropdown-text">HW 07</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../homework/hw08.Rmd">
 <span class="dropdown-text">HW 08</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../homework/hw09.Rmd">
 <span class="dropdown-text">HW 09</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../homework/hw10.Rmd">
 <span class="dropdown-text">HW 10</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-exercises" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text"><strong>Exercises</strong></span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-exercises">    
        <li>
    <a class="dropdown-item" href="../exercises/example-project-management-and-git.pdf">
 <span class="dropdown-text">project-management-and-git.pdf</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/grouping_and_summarizing_exercise.pdf">
 <span class="dropdown-text">grouping_and_summarizing_exercise.pdf</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/grouping-summarizing-and-plotting-exercise.pdf">
 <span class="dropdown-text">grouping-summarizing-and-plotting-exercise.pdf</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/visualizing-associations-exercise.pdf">
 <span class="dropdown-text">visualizing-associations-exercise.pdf</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/spatial-position-exercise.pdf">
 <span class="dropdown-text">spatial-position-exercise.pdf</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/visualizing-amounts-exercise.pdf">
 <span class="dropdown-text">visualizing-amounts-exercise.pdf</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/color-scales-exercise.pdf">
 <span class="dropdown-text">color-scales-exercise.pdf</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/coordinates-axes-and-scales-exercise.pdf">
 <span class="dropdown-text">coordinates-axes-and-scales-exercise.pdf</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/more-distributions-exercise.pdf">
 <span class="dropdown-text">more-distributions-exercise.pdf</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/uncertainty-and-variability-exercise.pdf">
 <span class="dropdown-text">uncertainty-and-variability-exercise.pdf</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/small-multiples-exercise.pdf">
 <span class="dropdown-text">small-multiples-exercise.pdf</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-data" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text"><strong>Data</strong></span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-data">    
        <li>
    <a class="dropdown-item" href="../data/baby-names-2008.csv">
 <span class="dropdown-text">baby-names-2008.csv</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../data/cms-top-all-time-2023-swim.xlsx">
 <span class="dropdown-text">cms-top-all-time-2023-swim.xlsx (/data/raw)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../data/cms-top-all-time-2023-swim.csv">
 <span class="dropdown-text">cms-top-all-time-2023-swim.csv (/data/raw)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../data/processed/cleaned-cms-top-all-time-2023-swim.csv">
 <span class="dropdown-text">cleaned-cms-top-all-time-2023-swim.csv (/data/processed)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../data/processed/cleaned-2023-cms-invite.csv">
 <span class="dropdown-text">cleaned-2023-cms-invite.csv (/data/processed)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/rfordatascience/tidytuesday">
 <span class="dropdown-text">Fun Tidy Tuesday Data Sets</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://dcas.dmdc.osd.mil/dcas/app/home">
 <span class="dropdown-text">Defense Casualty Analysis System (DCAS)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-example-files--other" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text"><strong>Example Files &amp; Other</strong></span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-example-files--other">    
        <li>
    <a class="dropdown-item" href="../resources/tools.html">
 <span class="dropdown-text"><strong>Other Tools/Resources</strong></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../examples/example-figure-script.R">
 <span class="dropdown-text">example-figure-script.R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../examples/example-rmarkdown-file-with-fig-script.Rmd">
 <span class="dropdown-text">example-rmarkdown-file-with-fig-script.Rmd</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-cheatsheets" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text"><strong>Cheatsheets</strong></span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-cheatsheets">    
        <li>
    <a class="dropdown-item" href="../cheatsheets_and_tips/symbols.html">
 <span class="dropdown-text">Symbols</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../cheatsheets/rmarkdown-2.0.pdf">
 <span class="dropdown-text">RMarkdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">
 <span class="dropdown-text">Data Wrangling with {dplyr} and {tidyr}</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://rstudio.github.io/cheatsheets/html/quarto.html">
 <span class="dropdown-text">Quarto (Publish and Share)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://rstudio.github.io/cheatsheets/html/strings.html">
 <span class="dropdown-text">String Manipulation with {stringr}</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://rstudio.github.io/cheatsheets/html/data-import.html">
 <span class="dropdown-text">Reading and Writing Data with {readr}</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../cheatsheets/Data_Science_With_R_Workflow.pdf">
 <span class="dropdown-text">Data Science with RWorkflow</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://rstudio.github.io/cheatsheets/">
 <span class="dropdown-text">More Cheatsheets From RStudio</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://images.datacamp.com/image/upload/v1676540721/Marketing/Blog/Quarto_Cheat_Sheet.pdf">
 <span class="dropdown-text">Quarto Cheat Sheet (what Quarto Files Look Like)</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/slicesofdata"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://gabrielcook.xyz"> 
<span class="menu-text">Me</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../modules/index.html"><b>Modules</b></a></li><li class="breadcrumb-item"><a href="../modules/statistical_transformations.html"><strong>Statistical transformations</strong></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../syllabus/syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Syllabus</strong></span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../schedule/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Schedule</strong></span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../modules_setup/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><b>Installation, Setup, &amp; R Basics</b></span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../modules_setup/Installation &amp; Setup/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><b>Installation &amp; Setup</b></span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules_setup/Installation &amp; Setup/installing_r_and_rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">**Installing R &amp; RStudio**</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules_setup/Installation &amp; Setup/installing_git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Installing Git</strong></span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../modules_setup/R Basics/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><b>R Basics and Refreshers</b></span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules_setup/R Basics/introduction_to_r_rstudio_and_rmarkdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to RStudio, R Markdown, &amp; Functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules_setup/R Basics/functions_and_scripts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Functions, Arguments, and R scripts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules_setup/R Basics/vectors_and_data_frame_basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vectors and data frame basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules_setup/R Basics/reading_data_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reading data files</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../modules/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><b>Modules</b></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../modules/project_management/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><b>Project Management</b></span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/project_management/setting_up_git_and_github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Project Management 01</strong>: Setting Up Git and GitHub for R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/project_management/using_git_and_github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Project Management 02</strong>: R Projects, Git, and GitHub</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/graphical_perception.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Graphical perception</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/data_frame_manipulation_and_wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Data frame manipulation and wrangling</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/data_subsets_and_summaries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Data subsets and summaries</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/considerations_in_data_visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Considerations in data visualization</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/designing_perceptually_efficient_visualizations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Designing perceptually-efficient visualizations</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/ggplot_and_the_grammar_of_graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong><code>{ggplot2}</code>: The Grammar of Graphics</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/visualizing_associations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Visualizing associations</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/spatial_position_and_adjustment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Spatial position and adjustment</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/visualizing_amounts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Visualizing amounts</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/color_scales_and_palettes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Color scales and palettes</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/histograms_and_density_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Histograms and density plots</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/coordinates_axes_and_position_scales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Coordinates, axes, and position scales</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/statistical_transformations.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><strong>Statistical transformations</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/visualizing_more_distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Visualizing more distributions</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/visualizing_uncertainty.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Visualizing uncertainty</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/legends_and_arrangement.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Legends and arrangement</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/visualizing_trends.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Visualizing trends</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/multi_panel_plots_faceting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Multi-panel plots: Faceting</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/annotation_and_text.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Annotation and text</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/attentional_control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Attentional control</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/themes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Bonus: Theme and figure design</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/titles_captions_and_tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Title, Captions, and Tables</strong></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../project/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><b>Project</b></span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project/01_project_team_roles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Team membership and roles</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project/02_project_midterm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Midterm presentation</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project/03_project_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Final Presentation</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project/04_project_report.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Final Report</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project/05_project_tasks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Project Tasks</strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project/06_using_git_with_branches.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Git Branch Merging Tutorial</strong></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="incremental">
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><strong>Overview</strong></a></li>
  <li><a href="#to-do" id="toc-to-do" class="nav-link" data-scroll-target="#to-do"><strong>To Do</strong></a>
  <ul class="incremental collapse">
  <li><a href="#optional-readings" id="toc-optional-readings" class="nav-link" data-scroll-target="#optional-readings"><strong>Optional Readings</strong></a></li>
  <li><a href="#external-functions" id="toc-external-functions" class="nav-link" data-scroll-target="#external-functions"><strong>External Functions</strong></a></li>
  <li><a href="#libraries" id="toc-libraries" class="nav-link" data-scroll-target="#libraries"><strong>Libraries</strong></a></li>
  <li><a href="#load-libraries" id="toc-load-libraries" class="nav-link" data-scroll-target="#load-libraries"><strong>Load libraries</strong></a></li>
  </ul></li>
  <li><a href="#loading-data" id="toc-loading-data" class="nav-link" data-scroll-target="#loading-data"><strong>Loading Data</strong></a></li>
  <li><a href="#flavors-of-data" id="toc-flavors-of-data" class="nav-link" data-scroll-target="#flavors-of-data"><strong>Flavors of Data</strong></a></li>
  <li><a href="#data-organization-and-variability" id="toc-data-organization-and-variability" class="nav-link" data-scroll-target="#data-organization-and-variability"><strong>Data Organization and Variability</strong></a></li>
  <li><a href="#aggregating-data" id="toc-aggregating-data" class="nav-link" data-scroll-target="#aggregating-data"><strong>Aggregating Data</strong></a></li>
  <li><a href="#statistical-summaries" id="toc-statistical-summaries" class="nav-link" data-scroll-target="#statistical-summaries"><strong>Statistical Summaries</strong></a>
  <ul class="incremental collapse">
  <li><a href="#identity-and-count-transformations" id="toc-identity-and-count-transformations" class="nav-link" data-scroll-target="#identity-and-count-transformations"><strong>Identity and Count Transformations</strong></a></li>
  <li><a href="#statistical-transformations-using-stat_summary" id="toc-statistical-transformations-using-stat_summary" class="nav-link" data-scroll-target="#statistical-transformations-using-stat_summary"><strong>Statistical Transformations using <code>stat_summary()</code></strong></a>
  <ul class="incremental collapse">
  <li><a href="#the-fun-parameter" id="toc-the-fun-parameter" class="nav-link" data-scroll-target="#the-fun-parameter"><strong>The <code>fun</code> parameter</strong></a></li>
  <li><a href="#the-fun.data-parameter" id="toc-the-fun.data-parameter" class="nav-link" data-scroll-target="#the-fun.data-parameter"><strong>The <code>fun.data</code> parameter</strong></a></li>
  </ul></li>
  <li><a href="#statistical-transformations-using-geom_boxplot" id="toc-statistical-transformations-using-geom_boxplot" class="nav-link" data-scroll-target="#statistical-transformations-using-geom_boxplot"><strong>Statistical Transformations using <code>geom_boxplot()</code></strong></a></li>
  </ul></li>
  <li><a href="#aggregating-data-using-group_by" id="toc-aggregating-data-using-group_by" class="nav-link" data-scroll-target="#aggregating-data-using-group_by"><strong>Aggregating Data using <code>group_by()</code></strong></a>
  <ul class="incremental collapse">
  <li><a href="#data-aggregation-using-group_by" id="toc-data-aggregation-using-group_by" class="nav-link" data-scroll-target="#data-aggregation-using-group_by"><em>Data aggregation using <code>group_by()</code></em></a></li>
  </ul></li>
  <li><a href="#comparing-mutate-with-summarize" id="toc-comparing-mutate-with-summarize" class="nav-link" data-scroll-target="#comparing-mutate-with-summarize"><strong>Comparing mutate() with summarize()</strong></a>
  <ul class="incremental collapse">
  <li><a href="#grouping-structure-of-group_by-and-mutate" id="toc-grouping-structure-of-group_by-and-mutate" class="nav-link" data-scroll-target="#grouping-structure-of-group_by-and-mutate"><em>Grouping structure of <code>group_by()</code> and <code>mutate()</code></em></a></li>
  <li><a href="#grouping-structure-of-group_by-and-summarize" id="toc-grouping-structure-of-group_by-and-summarize" class="nav-link" data-scroll-target="#grouping-structure-of-group_by-and-summarize"><em>Grouping structure of <code>group_by()</code> and <code>summarize()</code></em></a>
  <ul class="incremental collapse">
  <li><a href="#group_by-and-summarize-with-.groups" id="toc-group_by-and-summarize-with-.groups" class="nav-link" data-scroll-target="#group_by-and-summarize-with-.groups"><em><code>group_by()</code> and <code>summarize()</code> with <code>.groups</code></em></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#more-on-grouping-structure" id="toc-more-on-grouping-structure" class="nav-link" data-scroll-target="#more-on-grouping-structure"><strong>More on Grouping Structure</strong></a>
  <ul class="incremental collapse">
  <li><a href="#new-variable-columns" id="toc-new-variable-columns" class="nav-link" data-scroll-target="#new-variable-columns"><strong>New Variable Columns</strong></a>
  <ul class="incremental collapse">
  <li><a href="#group_by-using-a-function" id="toc-group_by-using-a-function" class="nav-link" data-scroll-target="#group_by-using-a-function"><strong><code>group_by()</code> using a function</strong></a></li>
  </ul></li>
  <li><a href="#adddrop-grouping-variable-columns" id="toc-adddrop-grouping-variable-columns" class="nav-link" data-scroll-target="#adddrop-grouping-variable-columns"><strong>Add/drop Grouping Variable Columns</strong></a>
  <ul class="incremental collapse">
  <li><a href="#retain-grouping" id="toc-retain-grouping" class="nav-link" data-scroll-target="#retain-grouping"><strong>Retain Grouping</strong></a></li>
  </ul></li>
  <li><a href="#why-care-about-grouping-structure" id="toc-why-care-about-grouping-structure" class="nav-link" data-scroll-target="#why-care-about-grouping-structure"><strong>Why Care About Grouping Structure</strong></a></li>
  </ul></li>
  <li><a href="#ungroup" id="toc-ungroup" class="nav-link" data-scroll-target="#ungroup"><strong>ungroup()</strong></a>
  <ul class="incremental collapse">
  <li><a href="#variable-loss-with-summarize" id="toc-variable-loss-with-summarize" class="nav-link" data-scroll-target="#variable-loss-with-summarize"><strong>Variable loss with <code>summarize()</code></strong></a></li>
  <li><a href="#an-alternative-to-summarize-reframe" id="toc-an-alternative-to-summarize-reframe" class="nav-link" data-scroll-target="#an-alternative-to-summarize-reframe"><strong>An alternative to <code>summarize()</code>: <code>reframe()</code></strong></a></li>
  <li><a href="#retaining-distinct-data-after-mutate-using-distinct" id="toc-retaining-distinct-data-after-mutate-using-distinct" class="nav-link" data-scroll-target="#retaining-distinct-data-after-mutate-using-distinct"><strong>Retaining distinct data after <code>mutate()</code> using distinct()`</strong></a></li>
  </ul></li>
  <li><a href="#visualizing-data" id="toc-visualizing-data" class="nav-link" data-scroll-target="#visualizing-data"><strong>Visualizing Data</strong></a></li>
  <li><a href="#adding-data-summaries-to-plots" id="toc-adding-data-summaries-to-plots" class="nav-link" data-scroll-target="#adding-data-summaries-to-plots"><strong>Adding Data Summaries to Plots</strong></a></li>
  <li><a href="#a-single-data-frame-using-mutate" id="toc-a-single-data-frame-using-mutate" class="nav-link" data-scroll-target="#a-single-data-frame-using-mutate"><strong>A Single Data Frame using <code>mutate()</code></strong></a>
  <ul class="incremental collapse">
  <li><a href="#the-jitter-problem-with-full-data-frame" id="toc-the-jitter-problem-with-full-data-frame" class="nav-link" data-scroll-target="#the-jitter-problem-with-full-data-frame"><strong>The Jitter problem with full data frame</strong></a></li>
  <li><a href="#examples-of-color-versions" id="toc-examples-of-color-versions" class="nav-link" data-scroll-target="#examples-of-color-versions"><strong>Examples of Color Versions</strong></a></li>
  <li><a href="#a-note-on-the-size-aesthetic" id="toc-a-note-on-the-size-aesthetic" class="nav-link" data-scroll-target="#a-note-on-the-size-aesthetic"><strong>A note on the <code>size</code> aesthetic</strong></a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><strong>Summary</strong></a></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info"><strong>Session Info</strong></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../modules/index.html"><b>Modules</b></a></li><li class="breadcrumb-item"><a href="../modules/statistical_transformations.html"><strong>Statistical transformations</strong></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><strong>Statistical transformations</strong></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gabriel I. Cook </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 31, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="overview" class="level1">
<h1><strong>Overview</strong></h1>
<p>This module describes some differences in data summaries and operations of functions in <strong>{dplyr}</strong>. Any form of data aggregation (e.g., data summary) will influence the contents of a data frame and consequently, how data are communicated visually. Depending on the data information you wish to communicate in your visualization, you may need to use different data frames or you may need to summarize a single data frame in a different ways either using <strong>{dplyr}</strong> functions like <code>group_by()</code> and <code>summarize()</code> or **{ggplot2}* functions like <code>stat_summary()</code>. For example, you may wish to communicate the <code>min()</code> and <code>max()</code> of some numeric variable in a single line-plot visualization in order to convey changes in <em>both</em> metrics. Alternatively, you may wish to display both <code>mean()</code> and <code>median()</code> values across time in the same visualization as seen below. You may also need to create multiple data frames if a single data frame contains either too much or too little information. We will also discuss differences in grouping structure for <code>dplyr::mutate()</code> and <code>dplyr::summarize()</code> that will affect both variable computation and plot creation.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="to-do" class="level1">
<h1><strong>To Do</strong></h1>
<p>Review corresponding Canvas video(s).</p>
<!--
## **Readings**

Reading should take place in two parts:

 - *Prior to class*, the goal should be to familiarize yourself and bring questions to class. The readings from [TFDV](https://clauswilke.com/dataviz) are conceptual and should facilitate readings from [EGDA](https://ggplot2-book.org/) for code implementation.
 - *After class*, the goal of reading should be to understand and implement code functions as well as support your understanding and help your troubleshooting of problems.  

*Before Class*: First, read to familiarize yourself with the concepts rather than master them. Understand why one would want to visualize data in a particular way and also understand some of the functionality of **{ggplot2}**. I will assume that you attend class with some level of basic understanding of concepts.

*Class*: In class, some functions and concepts will be introduced and we will practice implementing **{ggplot2}** code. On occasion, there will be an assessment involving code identification, correction, explanation, etc. of concepts addressed in previous modules and perhaps some conceptual elements from this week's readings. 

*After Class*: After having some hands-on experience with coding in class, homework assignments will involve writing your own code to address some problem. These problems will be more complex, will involving problem solving, and may be open ended. This is where the second pass at reading with come in for you to reference when writing your code. The module content presented below is designed to offer you some assistance working through various coding problems but may not always suffice as a replacement for the readings from **Wickham, Navarro, & Pedersen (under revision)**. *ggplot2: Elegant Graphics for Data Analysis (3e)*.

-->
<section id="optional-readings" class="level2">
<h2 class="anchored" data-anchor-id="optional-readings"><strong>Optional Readings</strong></h2>
<ul class="incremental">
<li><a href="https://ggplot2-book.org/statistical-summaries#sec-weighting">Wickham, Navarro, &amp; Pedersen (under revision). <em>ggplot2: Elegant Graphics for Data Analysis (3e)</em>. Weighting data</a></li>
<li><a href="https://ggplot2-book.org/layers#sec-stat">Wickham, Navarro, &amp; Pedersen (under revision). <em>ggplot2: Elegant Graphics for Data Analysis (3e)</em>. Stats</a></li>
</ul>
</section>
<section id="external-functions" class="level2">
<h2 class="anchored" data-anchor-id="external-functions"><strong>External Functions</strong></h2>
<p>Provided in class:</p>
<p><code>view_html()</code>: for viewing data frames in html format, from <code>/src/my_functions.R</code></p>
<p>You can use this in your own work space but I am having a challenge rendering this of the website, so I’ll default to <code>print()</code> on occasion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>R.utils<span class="sc">::</span><span class="fu">sourceDirectory</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"src"</span>, <span class="st">"functions"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="libraries" class="level2">
<h2 class="anchored" data-anchor-id="libraries"><strong>Libraries</strong></h2>
<ul class="incremental">
<li><strong>{dplyr}</strong> 1.1.4: for selecting, filtering, and mutating <!--- **{magrittr}** 2.0.3: for code clarity and piping data frame objects --></li>
<li><strong>{ggplot2}</strong> 3.5.1: for plotting</li>
</ul>
</section>
<section id="load-libraries" class="level2">
<h2 class="anchored" data-anchor-id="load-libraries"><strong>Load libraries</strong></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="loading-data" class="level1">
<h1><strong>Loading Data</strong></h1>
<p>To examine some associations, we will use some swimming event times which can be accessed from:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>https://raw.githubusercontent.com/slicesofdata/dataviz24/main/data/processed/cleaned-2023-cms-invite.csv</code></pre>
</div>
</div>
<p>To access the data, either read the file directly from the url using <code>read.csv()</code> and assign the data frame a name like <code>SWIM</code>:</p>
<p><code>read.csv("https://raw.githubusercontent.com/slicesofdata/dataviz24/main/data/processed/cleaned-2023-cms-invite.csv")</code></p>
<p>Or <a href="https://raw.githubusercontent.com/slicesofdata/dataviz24/main/data/processed/cleaned-2023-cms-invite.csv">download it</a> and save to the <code>/data/processed</code> directory and read from there.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"processed"</span>, <span class="st">"cleaned-2023-cms-invite.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="flavors-of-data" class="level1">
<h1><strong>Flavors of Data</strong></h1>
<p>Data come in many flavors. Data are collected on virtually everything you could think of. If there is a record of something, there is data. The stars, weather, television viewing, social media use, ocean currents, brand preference, parenting, symphonies, learning to code, graphical perceptual. When there is no record of something, you could collect data on it. For example, you could start logging the quantity of quality of advice your grandparents offer you. You may likely discover that advice changes based on their age. You may also consider logging the number to times you see your grandparents or your parents/guardians annually in order to determine approximately how many more times you will see them before they die, if they haven’t yet. In fact, some folks have already worked on this problem using actuarial tables. <strong><a href="https://seeyourfolks.com/">Seeyourfolks</a></strong> will provide a model estimate for you. See for yourself. Sure, it may be in error but all models have error. Nevertheless, prediction may change your life.</p>
</section>
<section id="data-organization-and-variability" class="level1">
<h1><strong>Data Organization and Variability</strong></h1>
<p>In some industries, data may be organized at a high level. For example, someone examining population growth may have data at a census level or an annual level. Someone who studies education may had data organized at a state level or county level. In other industries, data may be organized at a fine-grained level. For example, someone studying health outcomes may have data about individuals daily if daily health checks are part of a data-collection protocol. Someone who studies education may design a study to collect data, or obtain data, on daily-performance of students. Even further, their data may contain repeated measurements of specific topics (e.g., 10 different addition problems rather than one). Similarly, someone studying some aspect of human cognition may have high-level data like overall accuracy and total time needed to complete the task or they might have data at a low level containing trial-level accuracy and reaction timed data for each item.</p>
<p>Depending the organization of data and its level of granularity, one may be limited to a set of statistical models to examine. Because variability in data plays a significant role in testing models, the absence of variability will prevent modeling using statistical techniques that require that variability. For example, if your data set contains only one value for a country, you are likely limited to models that allow for comparisons or associations across countries or across time. For example, you could examine data to understand how population growth for a single country changes over time or you could examine population growth in one country compares to one or more than one country. Using the educational example, one could examine changes in a state over time or one could examine states to one another. By contrast, if you have daily data per student for a variety of topics, you have variability in data to examine at a variety of levels. You could examine how an individual’s performance changes across time in general or specifically for a specific topic. You can also examine how the individual performs on one type of task relative to another. You could also examine changes over time in performance on one task compared with changes over time for other tasks. Stepping up the hierarchy, you could compare performance of individuals across teachers, teacher’s sections, schools, school districts, counties, states, etc. because there is variability in the data to try to understand.</p>
<p>Although the data structure is typically conceived from top to bottom, which lower levels <em>nested</em> under higher levels, I will present the opposite order to prevent you reading from the bottom up.</p>
<pre><code>Daily Performance
- on an item type (e.g., 4 + 17)
-- on a task (e.g., addition)
--- for a person (e.g, Bill)
---- in a teacher's class (e.g., Mrs. Collins, Section 1)
----- in a school (e.g., Robert D. Wilson)
------ in a district (e.g., Western Wayne)
------- in a country (e.g., Wayne)
-------- in a state (e.g., Pennsylvania)
--------- in a country (e.g., United States of America)</code></pre>
<p>The structure at all these levels means that you can perform more complex models like linear-mixed models/hierarchical linear modeling. The variability in the data at all these levels allows you to account for the variability in ways you cannot if you only have top-level data. When you have the variability, you can examine for effect like random effects or fixed effects, which are not applicable to simpler linear models. To the extent that teachers in District A teach differently or motivate students differently from those teachers in District B, you could examine the data for these differences and account for them statistically (hold them constant as if teachers were the same) at higher levels of the data. In fact, that repeated-measures ANOVA model you are taught in your statistics class is not be appropriate for data with repeated measurements under different conditions because two individuals who with the same average performance may differ in their variability. For example, two students answer the subtraction problem (14 - 7) on average in 10.0 seconds across 5 instances. Mildred is consistent and answers it between 8 and 12 seconds. Tilford, however, answers with a range of 5 to 20 seconds. Although performance time is equated, the variability represents something very different in ability.</p>
</section>
<section id="aggregating-data" class="level1">
<h1><strong>Aggregating Data</strong></h1>
<p>Data aggregation refers to how data are organized or compiled. When you have multiple levels of data as presented in the example above, data aggregation refers to the process of taking the raw data and gathering it in some way to summarize for statistical analysis or data visualization. For example, you could summarize data by individual, class, school, district, county, and state. Alternatively, you could summarize data by district, county, and state and ignore individuals, class, and school. The two types of data aggregation will result in different numbers of cases (rows) in a data frame most obviously but also in the actual numbers.</p>
<p>The variability in individuals as well as in subgroups can be useful to answering your data question. Models like linear mixed models are beyond the scope of this course, however. Whether you look into those types of model or you don’t, you should realize that you are making a big assumption in your data when you aggregate at any level. That assumption is that the variability in the data that are aggregated is the same across all cases in the data. Specifically, by aggregating Tilford’s and Mildred’s individual data in order to obtain their average performance, you have lost the variability at the individual level and essentially arbitrarily set that variability to 0. At higher level, aggregating the data by <code>School</code> also means that you lose this information and make the assumption that there is no variability among individuals in each school (e.g., all individuals have the same value). Such assumptions are particularly relevant to repeated-measures models (e.g., repeated-measures ANOVA does not use this information) and are potentially not assumptions you want to make about your data.</p>
<p>In the end, how you interpret a model or a data visualization will be dependent on that aggregation of the data, modeled or displayed. The take home message about aggregating data, then, is that you trade off a loss of information for some summary. Only you can weigh the costs and benefits of this trade off. That said, sometimes you have no choice because your client, your employer, or your data resource has only data an an aggregate level. In those situations, you cannot do much except acknowledge the information loss in the ability of the model to predict an outcome. If, however, that aggregated level can still be summarized or aggregated in some way, you are back to reflecting on issues of aggregation.</p>
</section>
<section id="statistical-summaries" class="level1">
<h1><strong>Statistical Summaries</strong></h1>
<p>Whenever you create visualizations using <strong>{ggplot2}</strong>, there is some statistical transformation performed on the data. The data that are plotting represent that transformation. In some cases, the transformations are simple and in other cases they are complex. Let’s review some simple examples.</p>
<section id="identity-and-count-transformations" class="level2">
<h2 class="anchored" data-anchor-id="identity-and-count-transformations"><strong>Identity and Count Transformations</strong></h2>
<p>Looking at the <code>geom_point()</code> function, we see that <code>stat = "identity"</code> by default. When <code>"identity"</code> is set to <code>stat</code>, this will call the <code>stat_identity()</code> function for performing the transformation. Identity transformations are essentially a <strong>WYSIWYG (what you see is what you get)</strong> transformation, so this is not what you typically think of as a transformation.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="cn">NULL</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="cn">NULL</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">stat =</span> <span class="st">"identity"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">position =</span> <span class="st">"identity"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  ...,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">FALSE</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">show.legend =</span> <span class="cn">NA</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">inherit.aes =</span> <span class="cn">TRUE</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Using data, we see an example of <code>geom_point()</code> with this default operation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Split50, <span class="at">y =</span> Time)) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">stat =</span> <span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 15 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Other functions perform other statistical transformations on the data. For example, by default, <code>geom_bar()</code> will count the instances of a variable because the statistical transformation is <code>stat = "count"</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_bar</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">stat =</span> <span class="st">"count"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">position =</span> <span class="st">"stack"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  ...,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">just =</span> <span class="fl">0.5</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">orientation =</span> <span class="cn">NA</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">show.legend =</span> <span class="cn">NA</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">inherit.aes =</span> <span class="cn">TRUE</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And example with <code>geom_bar()</code> shows this but of course, we need to specify only an <code>x</code> or a <code>y</code> aesthetic for <code>geom_bar()</code>. In order to count something, we can use a variable that is not as distributed as those just used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Event)) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>But how is <code>geom_bar()</code> doing this transformation? Well, when <code>stat = "count"</code>, the <code>stat_count()</code> function is called with a default geom of <code>geom = "bar"</code>, thus plotting the counts with bars.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stat_count</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="cn">NULL</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="cn">NULL</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">geom =</span> <span class="st">"bar"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">position =</span> <span class="st">"stack"</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  ...,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="cn">NULL</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">orientation =</span> <span class="cn">NA</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">show.legend =</span> <span class="cn">NA</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">inherit.aes =</span> <span class="cn">TRUE</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Using <code>stat_count()</code> specifically, we can create the same plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Event)) <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_count</span>(<span class="at">geom =</span> <span class="st">"bar"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Other functions like <code>stat_summary()</code> or <code>stat_boxplot()</code> perform more complicated statistical transformations than simple counting. Let’s now address some of the complex transformations.</p>
</section>
<section id="statistical-transformations-using-stat_summary" class="level2">
<h2 class="anchored" data-anchor-id="statistical-transformations-using-stat_summary"><strong>Statistical Transformations using <code>stat_summary()</code></strong></h2>
<section id="the-fun-parameter" class="level3">
<h3 class="anchored" data-anchor-id="the-fun-parameter"><strong>The <code>fun</code> parameter</strong></h3>
<p>The <code>stat_summary()</code> function will perform statistical transforms on your data frame, and then use that modified data frame to plotting. The most common ways to transform the data is to pass arguments to the <code>fun</code> and <code>fun.data</code> parameters.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stat_summary</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="cn">NULL</span>,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="cn">NULL</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">geom =</span> <span class="st">"pointrange"</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">position =</span> <span class="st">"identity"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  ...,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.data =</span> <span class="cn">NULL</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun =</span> <span class="cn">NULL</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.max =</span> <span class="cn">NULL</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.min =</span> <span class="cn">NULL</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.args =</span> <span class="fu">list</span>(),</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">FALSE</span>,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">orientation =</span> <span class="cn">NA</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">show.legend =</span> <span class="cn">NA</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">inherit.aes =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.y =</span> <span class="fu">deprecated</span>(),</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.ymin =</span> <span class="fu">deprecated</span>(),</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.ymax =</span> <span class="fu">deprecated</span>()</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Initializing a plot and then adding <code>stat_summary()</code> layer will run the defaults. You will see a <code>geom = "pointrange"</code> which calls <code>geom_pointrange()</code>. A <code>geom_pointrange()</code> will need a <code>y</code>, <code>ymin</code>, and <code>ymax</code> which by default is computed using <code>mean_se()</code> (see console message), which is a mean +/- 1 standard error.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Event, <span class="at">y =</span> Time)) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>No summary function supplied, defaulting to `mean_se()`</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>OK, so this is a complicated first step. Let’s use a simpler approach by setting <code>fun = mean</code> to compute the mean in the form of a <code>geom = "bar"</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Event, <span class="at">y =</span> Time)) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"bar"</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>               )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>And setting <code>fun = median</code> to computes the median:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Event, <span class="at">y =</span> Time)) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> median,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"bar"</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>               )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Adding a second layer illustates how you can change the function and the geom. In particular, you can see when the distribution is skewed positively, negatively, or not so much.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Event, <span class="at">y =</span> Time)) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> median,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"bar"</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>               ) <span class="sc">+</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">geom =</span> <span class="st">"point"</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                 )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="the-fun.data-parameter" class="level3">
<h3 class="anchored" data-anchor-id="the-fun.data-parameter"><strong>The <code>fun.data</code> parameter</strong></h3>
<p>Compared with <code>fun</code>, <code>fun.data</code> will need a function that returns a data frame with a <code>y</code>, <code>ymin</code>, and a <code>ymax</code>. The <code>mean_se</code> function used by default in <code>stat_summary()</code> provides those values but we can set them manually.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Event, <span class="at">y =</span> Time)) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_se) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>But if you want to plot 2 standard errors of the mean, you will need to use <code>fun.args = list(mult = 2)</code> for passing a multiple of the <code>mean_se</code> function. This really isn’t so bad when you understand how to do it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Event, <span class="at">y =</span> Time)) <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_se, </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">fun.args =</span> <span class="fu">list</span>(<span class="at">mult =</span> <span class="dv">2</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>But <strong>{ggplot2}</strong> has other built in functions, like <code>mean_sdl</code> which will compute a mean +/- 1 standard deviation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Event, <span class="at">y =</span> Time)) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_sdl) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>And <code>mean_cl_boot</code> will compute a mean and a bootstrapped confidence interval.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Event, <span class="at">y =</span> Time)) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_cl_boot) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can also create our own functions to pass to <code>fun</code> if there is single value or to pass to <code>fun.data</code> if there is a <code>y</code>, <code>ymin</code>, and <code>ymax</code>. Let’s create them using <code>function()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>trimmed_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">trim =</span> <span class="fl">0.1</span>)  <span class="co"># Trim 10% of the values</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>iqr_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="fu">na.omit</span>(x)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">median</span>(x),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="fu">quantile</span>(x, <span class="fl">0.25</span>),</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> <span class="fu">quantile</span>(x, <span class="fl">0.75</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pass <code>fun = trimmed_mean</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Event, <span class="at">y =</span> Time)) <span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> trimmed_mean) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Or pass <code>fun.data = iqr_summary</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Event, <span class="at">y =</span> Time)) <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> iqr_summary) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="statistical-transformations-using-geom_boxplot" class="level2">
<h2 class="anchored" data-anchor-id="statistical-transformations-using-geom_boxplot"><strong>Statistical Transformations using <code>geom_boxplot()</code></strong></h2>
<p>Although you can plot quartiles as just shown, a box-and-whisked plot is the best for this. Beyond <code>geom_mooth()</code> and <code>stat_summary()</code>, <code>geom_boxplot()</code> also performs statistical transformations. Although this <code>geom</code> is beyond the scope of this topic, we can at least see the statistical transformation is very unique, <code>stat = "boxplot"</code>.</p>
<p>When you want to perform a compl</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_boxplot</span>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="cn">NULL</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="cn">NULL</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">stat =</span> <span class="st">"boxplot"</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">position =</span> <span class="st">"dodge2"</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  ...,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">outliers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">outlier.colour =</span> <span class="cn">NULL</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">outlier.color =</span> <span class="cn">NULL</span>,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">outlier.fill =</span> <span class="cn">NULL</span>,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">outlier.shape =</span> <span class="dv">19</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">outlier.size =</span> <span class="fl">1.5</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">outlier.stroke =</span> <span class="fl">0.5</span>,</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">outlier.alpha =</span> <span class="cn">NULL</span>,</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">notch =</span> <span class="cn">FALSE</span>,</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">notchwidth =</span> <span class="fl">0.5</span>,</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">staplewidth =</span> <span class="dv">0</span>,</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">varwidth =</span> <span class="cn">FALSE</span>,</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">FALSE</span>,</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">orientation =</span> <span class="cn">NA</span>,</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">show.legend =</span> <span class="cn">NA</span>,</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">inherit.aes =</span> <span class="cn">TRUE</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can see how the box plot provides quartile information as we did with a custom function. The boxplot provides additional information as well. A topic for another time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Time <span class="sc">&lt;</span> <span class="dv">500</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Event, <span class="at">y =</span> Time)) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="aggregating-data-using-group_by" class="level1">
<h1><strong>Aggregating Data using <code>group_by()</code></strong></h1>
<p><strong>{dplyr}</strong> has one main verb function for grouping data. <code>group_by()</code> orders the groups in an ascending order so that functions performed on the subgroups will return a data frame that is ordered based on the grouping variable(s). Other functions like <code>group_map()</code>, <code>group_nest()</code>, <code>group_split()</code>, and <code>group_trim()</code> exist but they are experimental for <strong>{dplyr}</strong> <code>r</code>packageVersion(“dplyr”)`. Although they allow for fun tasks like passing data subsets to statistical models, their experimental life cycle suggests you might not get to comfortable with them.</p>
<section id="data-aggregation-using-group_by" class="level2">
<h2 class="anchored" data-anchor-id="data-aggregation-using-group_by"><em>Data aggregation using <code>group_by()</code></em></h2>
<p>Let’s go through a simple example of data aggregation using <code>group_by()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Student =</span> <span class="fu">c</span>(<span class="st">"Jim"</span>, <span class="st">"Sally"</span>, <span class="st">"June"</span>, <span class="st">"Mildred"</span>, <span class="st">"Tilford"</span>, <span class="st">"Beavis"</span>, <span class="st">"Herman"</span>, <span class="st">"Peppa"</span>, <span class="st">"Kay"</span>, <span class="st">"Jake"</span>, <span class="st">"Name Missing"</span>),</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Score  =</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">85</span>, <span class="dv">79</span>, <span class="dv">80</span>, <span class="dv">81</span>, <span class="dv">91</span>, <span class="dv">89</span>, <span class="dv">60</span>, <span class="dv">65</span>, <span class="dv">67</span>, <span class="dv">65</span>), </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">School =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"C"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"D"</span>, <span class="st">"E"</span>, <span class="st">"E"</span>), </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">District =</span> <span class="fu">c</span>(<span class="st">"West"</span>, <span class="st">"West"</span>, <span class="st">"West"</span>, <span class="st">"West"</span>, <span class="st">"East"</span>, <span class="st">"East"</span>, <span class="st">"East"</span>, <span class="st">"North"</span>, <span class="st">"North"</span> , <span class="st">"North"</span>, <span class="st">"North"</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can see that the performance for all students is on average, for example, if you didn’t know where they went to school. We would take only the mean.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Score =</span> <span class="fu">mean</span>(Score))     <span class="co"># calculate average</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Score
1 76.54545</code></pre>
</div>
</div>
<p>Let’s say we try to determine average performance for “all students” if we had the data aggregated as the school level and not the individual level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(School) <span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Score =</span> <span class="fu">mean</span>(Score)) <span class="sc">|&gt;</span>  <span class="co"># get the school level aggregated data</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Score =</span> <span class="fu">mean</span>(Score))     <span class="co"># then calculate average across all schools</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  Score
  &lt;dbl&gt;
1  75.5</code></pre>
</div>
</div>
<p>Let’s say we try to determine average performance for “all students” if we had the data aggregated as the district level and not the individual level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(District) <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Score =</span> <span class="fu">mean</span>(Score)) <span class="sc">|&gt;</span> <span class="co"># get the district level aggregated data</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Score =</span> <span class="fu">mean</span>(Score))     <span class="co"># then calculate average across all districts</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  Score
  &lt;dbl&gt;
1  77.4</code></pre>
</div>
</div>
<p>So what’s the average performance for students? Well, that interpretation differs based on how values are treated. At the highest level, all students’ <code>Scores</code> are weighed equally. Each student contributes to the data in the same way. When aggregated by <code>School</code>, each school contributes to the calculation equally, even if the number of bodies per school differs. And finally, when data are aggregated at the <code>District</code> level, all districts are treated equally in the calculation independent on the number of schools in a district. Only with weighting means would you end up with the same average performance.</p>
<p>Measures of variability in the data, however, reveal something else. Schools differ in variability and schools within districts vary as well. Depending on the level of aggregation, you may never notice interesting patterns in data that lead to questions to investigate and later policies to change. For example, addressing a school that is left behind others or a district that is left behind others. Aggregation can also lead to inefficient allocations of resources. If one school in a district needs help rather than all schools in the district needing help, the cost may differ substantially.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>std_error <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { <span class="fu">sd</span>(<span class="fu">na.omit</span>(x)) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(<span class="fu">na.omit</span>(x))) }</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(School, District) <span class="sc">|&gt;</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Var =</span> <span class="fu">var</span>(Score),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">SD  =</span> <span class="fu">sd</span>(Score),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">SEM =</span> <span class="fu">std_error</span>(Score),</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">min =</span> <span class="fu">min</span>(Score),</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">max =</span> <span class="fu">max</span>(Score)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">range =</span> (max <span class="sc">-</span> min))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'School'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 8
# Groups:   School [5]
  School District   Var    SD   SEM   min   max range
  &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 A      West      12.5 3.54   2.5     80    85     5
2 B      West       0.5 0.707  0.5     79    80     1
3 C      East      28   5.29   3.06    81    91    10
4 D      North     12.5 3.54   2.5     60    65     5
5 E      North      2   1.41   1       65    67     2</code></pre>
</div>
</div>
</section>
</section>
<section id="comparing-mutate-with-summarize" class="level1">
<h1><strong>Comparing mutate() with summarize()</strong></h1>
<p><strong>{dplyr}</strong> has two main verb functions for creating variables. They operate differently and their returned tibble also differ. If you have not been paying attention to the returned tibble post calculation, you might have overlooked the differences.</p>
<section id="grouping-structure-of-group_by-and-mutate" class="level2">
<h2 class="anchored" data-anchor-id="grouping-structure-of-group_by-and-mutate"><em>Grouping structure of <code>group_by()</code> and <code>mutate()</code></em></h2>
<p>Let’s <code>mutate()</code> the mean for <code>Score</code> after sub-setting with <code>group_by()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(School, District) <span class="sc">|&gt;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Score =</span> <span class="fu">mean</span>(<span class="fu">na.omit</span>(Score)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 4
# Groups:   School, District [5]
   Student      Score School District
   &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;   
 1 Jim           82.5 A      West    
 2 Sally         82.5 A      West    
 3 June          79.5 B      West    
 4 Mildred       79.5 B      West    
 5 Tilford       87   C      East    
 6 Beavis        87   C      East    
 7 Herman        87   C      East    
 8 Peppa         62.5 D      North   
 9 Kay           62.5 D      North   
10 Jake          66   E      North   
11 Name Missing  66   E      North   </code></pre>
</div>
</div>
<p>There are two things to watch when using this <code>mutate()</code> following <code>group_by()</code>.</p>
<p><strong>1.</strong> A <code>Score</code> will be assigned to each row/case or <code>Student</code> in the data frame.</p>
<p>When schools and districts are grouped, each student in the same school will have the same assigned average value. All rows are maintained, none dropped.</p>
<p><strong>2.</strong> The returned tibble takes on a new structure.</p>
<p>Looking at the feedback in the console, you see the following report preceding the data.</p>
<pre><code>A tibble: 11 × 3
# Groups:   School, District [5]</code></pre>
<p>You also see this structure using <code>glimpse()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(School, District) <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Score =</span> <span class="fu">mean</span>(<span class="fu">na.omit</span>(Score))) <span class="sc">|&gt;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 11
Columns: 4
Groups: School, District [5]
$ Student  &lt;chr&gt; "Jim", "Sally", "June", "Mildred", "Tilford", "Beavis", "Herm…
$ Score    &lt;dbl&gt; 82.5, 82.5, 79.5, 79.5, 87.0, 87.0, 87.0, 62.5, 62.5, 66.0, 6…
$ School   &lt;chr&gt; "A", "A", "B", "B", "C", "C", "C", "D", "D", "E", "E"
$ District &lt;chr&gt; "West", "West", "West", "West", "East", "East", "East", "Nort…</code></pre>
</div>
</div>
<pre><code>Rows: 11
Columns: 3
Groups: School, District [5]</code></pre>
<p>What does the <code>[5]</code> mean? Well, before we answer this, let’s use <code>summarize()</code>.</p>
</section>
<section id="grouping-structure-of-group_by-and-summarize" class="level2">
<h2 class="anchored" data-anchor-id="grouping-structure-of-group_by-and-summarize"><em>Grouping structure of <code>group_by()</code> and <code>summarize()</code></em></h2>
<p>Let’s <code>summarize()</code> the mean for <code>Score</code> after sub-setting with <code>group_by()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(School, District) <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Score =</span> <span class="fu">mean</span>(Score))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'School'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
# Groups:   School [5]
  School District Score
  &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;
1 A      West      82.5
2 B      West      79.5
3 C      East      87  
4 D      North     62.5
5 E      North     66  </code></pre>
</div>
</div>
<p>There are two things to watch when using this <code>summarize()</code> following <code>group_by()</code>.</p>
<p><strong>1.</strong> A <code>Score</code> average is assigned to each row/case or <code>School</code> in this aggregated data frame.</p>
<p>When schools and districts are grouped, each school will have its own average value. Rows from the data frame are dropped as are columns that are not passed to <code>group_by()</code>. In this case, <code>School</code>, <code>District</code>, and the new variable, <code>Score</code> are returned.</p>
<p><strong>2.</strong> The returned tibble takes on a new structure.</p>
<p>The feedback in the console is a little more detailed here.</p>
<pre><code>`summarise()` has grouped output by 'School'. You can override using the `.groups` argument.
# A tibble: 5 × 3
# Groups:   School [5]</code></pre>
<p>You see reference to overriding the grouping using <code>.groups</code>. According to the <a href="https://dplyr.tidyverse.org/articles/grouping.html">tidyverse documentation for grouping</a>, this parameter <em>“controls the grouping structure of the output. The historical behavior of removing the right hand side grouping variable corresponds to <code>.groups = "drop_last"</code> without a message or <code>.groups = NULL</code> with a message (the default)”</em>.</p>
<p>You have most likely paid little attention to this message. By default <code>summarize()</code> keeps the first grouping variable passed to <code>group_by()</code> in the returned tibble. This is why you see <code>School</code> referenced and not <code>District</code> or both variables. So, do you want your data frame to contain groups or no groups? Stated differently, do you just want that data summarized by your grouping variables and have a simple nxm data frame or do you want something more complex?</p>
<p>To see the structure better, let’s first look a the structure of <code>DATA</code> and then more closely at the summarized version.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(DATA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   11 obs. of  4 variables:
 $ Student : chr  "Jim" "Sally" "June" "Mildred" ...
 $ Score   : num  80 85 79 80 81 91 89 60 65 67 ...
 $ School  : chr  "A" "A" "B" "B" ...
 $ District: chr  "West" "West" "West" "West" ...</code></pre>
</div>
</div>
<p>Let’s assign the summarized data frame to an object for inspection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>DSUM <span class="ot">&lt;-</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  DATA <span class="sc">|&gt;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(School, District) <span class="sc">|&gt;</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Score =</span> <span class="fu">mean</span>(Score))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'School'. You can override using the
`.groups` argument.</code></pre>
</div>
</div>
<p>For <code>DSUM</code>, the structure is different. In particular, you see reference to <code>(S3: grouped_df/tbl_df/tbl/data.frame)</code>. This tells you that the data frame is not a simple nxm but contains groups. You could think of this as 3 nxm data frames organized together. For more details, see the <a href="https://dplyr.tidyverse.org/reference/grouped_df.html">dplyr</a> documentation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(DSUM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>gropd_df [5 × 3] (S3: grouped_df/tbl_df/tbl/data.frame)
 $ School  : chr [1:5] "A" "B" "C" "D" ...
 $ District: chr [1:5] "West" "West" "East" "North" ...
 $ Score   : num [1:5] 82.5 79.5 87 62.5 66
 - attr(*, "groups")= tibble [5 × 2] (S3: tbl_df/tbl/data.frame)
  ..$ School: chr [1:5] "A" "B" "C" "D" ...
  ..$ .rows : list&lt;int&gt; [1:5] 
  .. ..$ : int 1
  .. ..$ : int 2
  .. ..$ : int 3
  .. ..$ : int 4
  .. ..$ : int 5
  .. ..@ ptype: int(0) 
  ..- attr(*, ".drop")= logi TRUE</code></pre>
</div>
</div>
<section id="group_by-and-summarize-with-.groups" class="level3">
<h3 class="anchored" data-anchor-id="group_by-and-summarize-with-.groups"><em><code>group_by()</code> and <code>summarize()</code> with <code>.groups</code></em></h3>
<p>When you group data using <code>group_by()</code> and then <code>summarize()</code>, the summary variables (e.g., mean) will result in a single row for each level of a single grouping variable. If there are more than one grouping variable, the additional grouping variable will be introduced to the data frame as a second column. The total number of rows in the data frame will be equal to the <em>number of levels of group 1</em> x <em>number of levels of group 2</em> if an only if each levels of group 1 has a corresponding level for group 2,</p>
<p>for example:</p>
<pre><code>sex   age    mean
men   young  x
men   old    x
women young  x
women old    x</code></pre>
<p>If there is no pairing of levels in the data (e.g., no men who are old), that row will be omitted from the returned data frame.</p>
<p>for example:</p>
<pre><code>sex   age    mean
men   young  x
women young  x
women old    x</code></pre>
<p>rather than:</p>
<pre><code>sex   age    mean
men   young  x
men   old    NA
women young  x
women old    x</code></pre>
<p>You really need to query <code>?dplyr::summarize</code> to understand <code>.groups</code>, which controls the grouping of the returned data frame. This is also experimental to <code>summarize()</code>, so it might not be available in the future.</p>
<p>There are four argument options:</p>
<ul class="incremental">
<li><code>"drop_last"</code>: dropping the last level of grouping. This was the only supported option before version 1.0.0.</li>
<li><code>"drop"</code>: All levels of grouping are dropped.</li>
<li><code>"keep"</code>: Same grouping structure as .data.</li>
<li><code>"rowwise"</code>: Each row is its own group.</li>
</ul>
<section id="groups-drop_last" class="level4">
<h4 class="anchored" data-anchor-id="groups-drop_last"><code>.groups = "drop_last"</code>:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Event, Distance) <span class="sc">|&gt;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Time =</span> <span class="fu">mean</span>(Time),</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop_last"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 3
# Groups:   Event [6]
   Event        Distance   Time
   &lt;chr&gt;           &lt;int&gt;  &lt;dbl&gt;
 1 Backstroke        100   59.8
 2 Backstroke        200  124. 
 3 Breaststroke      100   61.6
 4 Breaststroke      200  139. 
 5 Butterfly         100   55.3
 6 Butterfly         200  125. 
 7 Freestyle          50   23.6
 8 Freestyle         100   51.9
 9 Freestyle         200  107. 
10 Freestyle         500  306. 
11 Freestyle        1650 1143. 
12 IM                200  126. 
13 IM                400  269. 
14 Medley            200  104. </code></pre>
</div>
</div>
<p>You will see that the grouping for <code>Distance</code> is not in the grouping structure because it was the last grouping.</p>
<pre><code># A tibble: 14 × 3
# Groups:   Event [6]
   Event        Distance   Time</code></pre>
</section>
<section id="groups-drop" class="level4">
<h4 class="anchored" data-anchor-id="groups-drop"><code>.groups = "drop"</code>:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Event, Distance) <span class="sc">|&gt;</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Time =</span> <span class="fu">mean</span>(Time),</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 3
   Event        Distance   Time
   &lt;chr&gt;           &lt;int&gt;  &lt;dbl&gt;
 1 Backstroke        100   59.8
 2 Backstroke        200  124. 
 3 Breaststroke      100   61.6
 4 Breaststroke      200  139. 
 5 Butterfly         100   55.3
 6 Butterfly         200  125. 
 7 Freestyle          50   23.6
 8 Freestyle         100   51.9
 9 Freestyle         200  107. 
10 Freestyle         500  306. 
11 Freestyle        1650 1143. 
12 IM                200  126. 
13 IM                400  269. 
14 Medley            200  104. </code></pre>
</div>
</div>
<p>You will see that all group are <em>dropped</em> from the grouping structure.</p>
<pre><code># A tibble: 14 × 3
   Event        Distance   Time</code></pre>
</section>
<section id="groups-keep" class="level4">
<h4 class="anchored" data-anchor-id="groups-keep"><code>.groups = "keep"</code>:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Event, Distance) <span class="sc">|&gt;</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Time =</span> <span class="fu">mean</span>(Time),</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"keep"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 3
# Groups:   Event, Distance [14]
   Event        Distance   Time
   &lt;chr&gt;           &lt;int&gt;  &lt;dbl&gt;
 1 Backstroke        100   59.8
 2 Backstroke        200  124. 
 3 Breaststroke      100   61.6
 4 Breaststroke      200  139. 
 5 Butterfly         100   55.3
 6 Butterfly         200  125. 
 7 Freestyle          50   23.6
 8 Freestyle         100   51.9
 9 Freestyle         200  107. 
10 Freestyle         500  306. 
11 Freestyle        1650 1143. 
12 IM                200  126. 
13 IM                400  269. 
14 Medley            200  104. </code></pre>
</div>
</div>
<p>You will see that all group are <em>kept</em> in the grouping structure.</p>
<pre><code># A tibble: 14 × 3
# Groups:   Event, Distance [14]
   Event        Distance   Time</code></pre>
</section>
<section id="groups-rowwise" class="level4">
<h4 class="anchored" data-anchor-id="groups-rowwise"><code>.groups = "rowwise"</code>:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Event, Distance) <span class="sc">|&gt;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Time =</span> <span class="fu">mean</span>(Time),</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"rowwise"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 3
# Rowwise:  Event, Distance
   Event        Distance   Time
   &lt;chr&gt;           &lt;int&gt;  &lt;dbl&gt;
 1 Backstroke        100   59.8
 2 Backstroke        200  124. 
 3 Breaststroke      100   61.6
 4 Breaststroke      200  139. 
 5 Butterfly         100   55.3
 6 Butterfly         200  125. 
 7 Freestyle          50   23.6
 8 Freestyle         100   51.9
 9 Freestyle         200  107. 
10 Freestyle         500  306. 
11 Freestyle        1650 1143. 
12 IM                200  126. 
13 IM                400  269. 
14 Medley            200  104. </code></pre>
</div>
</div>
<p>You will see that there groups but these are <em>not</em> based on the</p>
<pre><code># A tibble: 14 × 3
# Rowwise:  Event, Distance</code></pre>
<p>The grouping structure always matters for subsequent computations. But with <code>"rowwise"</code> you will see this clearly. Following from above, let’s say we wanted to compute the mean across all of the <code>Events</code> in the data frame returned by <code>group_by()</code> then <code>summarize()</code>. We add <code>mutate(mean = mean(Time))</code> on a new line of our piped code block.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Event, Distance) <span class="sc">|&gt;</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Time =</span> <span class="fu">mean</span>(Time),</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"rowwise"</span>) <span class="sc">|&gt;</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean =</span> <span class="fu">mean</span>(Time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 4
# Rowwise:  Event, Distance
   Event        Distance   Time   mean
   &lt;chr&gt;           &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 Backstroke        100   59.8   59.8
 2 Backstroke        200  124.   124. 
 3 Breaststroke      100   61.6   61.6
 4 Breaststroke      200  139.   139. 
 5 Butterfly         100   55.3   55.3
 6 Butterfly         200  125.   125. 
 7 Freestyle          50   23.6   23.6
 8 Freestyle         100   51.9   51.9
 9 Freestyle         200  107.   107. 
10 Freestyle         500  306.   306. 
11 Freestyle        1650 1143.  1143. 
12 IM                200  126.   126. 
13 IM                400  269.   269. 
14 Medley            200  104.   104. </code></pre>
</div>
</div>
<p>The <code>mean</code> column does not contain a single mean replicated for each row in the data frame. Rather the grouping was per row, so each row has its one mean. The mean of a single value is, of course, itself.</p>
</section>
<section id="revisiting-.groups-drop_last" class="level4">
<h4 class="anchored" data-anchor-id="revisiting-.groups-drop_last">Revisiting <code>".groups = drop_last"</code>:</h4>
<p>Returning to the default <code>.groups</code> structure, which is <code>"drop_last"</code>, we can add the same <code>mutate()</code> to see what happens.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Event, Distance) <span class="sc">|&gt;</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Time =</span> <span class="fu">mean</span>(Time),</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop_last"</span>) <span class="sc">|&gt;</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean =</span> <span class="fu">mean</span>(Time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 4
# Groups:   Event [6]
   Event        Distance   Time  mean
   &lt;chr&gt;           &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1 Backstroke        100   59.8  92.1
 2 Backstroke        200  124.   92.1
 3 Breaststroke      100   61.6 100. 
 4 Breaststroke      200  139.  100. 
 5 Butterfly         100   55.3  90.4
 6 Butterfly         200  125.   90.4
 7 Freestyle          50   23.6 326. 
 8 Freestyle         100   51.9 326. 
 9 Freestyle         200  107.  326. 
10 Freestyle         500  306.  326. 
11 Freestyle        1650 1143.  326. 
12 IM                200  126.  197. 
13 IM                400  269.  197. 
14 Medley            200  104.  104. </code></pre>
</div>
</div>
<p>The <code>mean</code> column still has different values but they are replicated on rows with the same <code>Event</code> group. This is because the data are grouped that way.</p>
</section>
<section id="revisiting-.groups-drop" class="level4">
<h4 class="anchored" data-anchor-id="revisiting-.groups-drop">Revisiting <code>.groups = "drop"</code>:</h4>
<p>Let’s again add the same <code>mutate()</code> to see what happens.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Event, Distance) <span class="sc">|&gt;</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Time =</span> <span class="fu">mean</span>(Time),</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean =</span> <span class="fu">mean</span>(Time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 4
   Event        Distance   Time  mean
   &lt;chr&gt;           &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1 Backstroke        100   59.8  193.
 2 Backstroke        200  124.   193.
 3 Breaststroke      100   61.6  193.
 4 Breaststroke      200  139.   193.
 5 Butterfly         100   55.3  193.
 6 Butterfly         200  125.   193.
 7 Freestyle          50   23.6  193.
 8 Freestyle         100   51.9  193.
 9 Freestyle         200  107.   193.
10 Freestyle         500  306.   193.
11 Freestyle        1650 1143.   193.
12 IM                200  126.   193.
13 IM                400  269.   193.
14 Medley            200  104.   193.</code></pre>
</div>
</div>
</section>
<section id="consider-ungroup" class="level4">
<h4 class="anchored" data-anchor-id="consider-ungroup">Consider <code>ungroup()</code>:</h4>
<p><code>.groups = "drop"</code> in effect works the same as does <code>ungroup()</code>. The grouping structure is broken and all subsequent operations are based on the ungrouped data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Event, Distance) <span class="sc">|&gt;</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Time =</span> <span class="fu">mean</span>(Time)) <span class="sc">|&gt;</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean =</span> <span class="fu">mean</span>(Time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Event'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 4
   Event        Distance   Time  mean
   &lt;chr&gt;           &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1 Backstroke        100   59.8  193.
 2 Backstroke        200  124.   193.
 3 Breaststroke      100   61.6  193.
 4 Breaststroke      200  139.   193.
 5 Butterfly         100   55.3  193.
 6 Butterfly         200  125.   193.
 7 Freestyle          50   23.6  193.
 8 Freestyle         100   51.9  193.
 9 Freestyle         200  107.   193.
10 Freestyle         500  306.   193.
11 Freestyle        1650 1143.   193.
12 IM                200  126.   193.
13 IM                400  269.   193.
14 Medley            200  104.   193.</code></pre>
</div>
</div>
<p>Keep in mind that functions work as they are programmed to work. Functions do not work like you think they work. You must understand the function and check our work to ensure your calculations are what you intend them to be.</p>
</section>
<section id="the-order-of-operations-matters" class="level4">
<h4 class="anchored" data-anchor-id="the-order-of-operations-matters">The <em>order of operations</em> matters</h4>
<p>To illustrate further, consider you want to calculate some summary statistics. You set out to obtain the mean and the standard deviation for your data. Those computations will be performed according to the grouping structure.</p>
<p>When you compute standard deviation and the mean of <code>Time</code>, you assign the mean to <code>Time</code> because you want your plot to contain a clean name rather than one like <code>Time_Mean</code> that you will have to address in the plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Event, Distance) <span class="sc">|&gt;</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Time_sd =</span> <span class="fu">sd</span>(Time),  <span class="co"># get sd of Time</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">Time =</span> <span class="fu">mean</span>(Time)    <span class="co"># get mean, assign to same name</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>            )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Event'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 4
# Groups:   Event [6]
   Event        Distance Time_sd   Time
   &lt;chr&gt;           &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt;
 1 Backstroke        100    4.47   59.8
 2 Backstroke        200    8.02  124. 
 3 Breaststroke      100    5.76   61.6
 4 Breaststroke      200   10.5   139. 
 5 Butterfly         100    4.32   55.3
 6 Butterfly         200    7.74  125. 
 7 Freestyle          50    1.99   23.6
 8 Freestyle         100    4.00   51.9
 9 Freestyle         200   10.8   107. 
10 Freestyle         500   20.3   306. 
11 Freestyle        1650   98.2  1143. 
12 IM                200    8.13  126. 
13 IM                400   22.2   269. 
14 Medley            200    3.41  104. </code></pre>
</div>
</div>
<p>Both variables use the same data because the standard deviation assigns the value to a different variable name <code>Time_sd</code>. The <code>mean()</code> is not based on some changed variable.</p>
<p>The output is different from the one returned when the mean is computed before the standard deviation and in particular when the mean is assigned to <code>Time</code>. In this case, the standard deviation is based on this new <code>Time</code> variable. Because the standard deviation is a measure of variability, and <code>Time</code> does not vary based on the grouping structure, <code>NA</code> is returned.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Event, Distance) <span class="sc">|&gt;</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Time =</span> <span class="fu">mean</span>(Time),   <span class="co"># get mean, assign to same name</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">Time_sd =</span> <span class="fu">sd</span>(Time)   <span class="co"># get sd of Time        </span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>            )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Event'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 4
# Groups:   Event [6]
   Event        Distance   Time Time_sd
   &lt;chr&gt;           &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt;
 1 Backstroke        100   59.8      NA
 2 Backstroke        200  124.       NA
 3 Breaststroke      100   61.6      NA
 4 Breaststroke      200  139.       NA
 5 Butterfly         100   55.3      NA
 6 Butterfly         200  125.       NA
 7 Freestyle          50   23.6      NA
 8 Freestyle         100   51.9      NA
 9 Freestyle         200  107.       NA
10 Freestyle         500  306.       NA
11 Freestyle        1650 1143.       NA
12 IM                200  126.       NA
13 IM                400  269.       NA
14 Medley            200  104.       NA</code></pre>
</div>
</div>
<p>If you really wanted the standard deviation of all the means, consider ungrouping and then compute the standard deviation or use <code>.groups =  "drop"</code> in <code>summarize()</code>. Realize, however, this latter functionality is experimental and may not work sometime later. You are likely better off using <code>ungroup()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>SWIM <span class="sc">|&gt;</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Event, Distance) <span class="sc">|&gt;</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Time =</span> <span class="fu">mean</span>(Time)) <span class="sc">|&gt;</span>  <span class="co"># get mean, assign to same name</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sd =</span> <span class="fu">sd</span>(Time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Event'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 4
   Event        Distance   Time    sd
   &lt;chr&gt;           &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1 Backstroke        100   59.8  285.
 2 Backstroke        200  124.   285.
 3 Breaststroke      100   61.6  285.
 4 Breaststroke      200  139.   285.
 5 Butterfly         100   55.3  285.
 6 Butterfly         200  125.   285.
 7 Freestyle          50   23.6  285.
 8 Freestyle         100   51.9  285.
 9 Freestyle         200  107.   285.
10 Freestyle         500  306.   285.
11 Freestyle        1650 1143.   285.
12 IM                200  126.   285.
13 IM                400  269.   285.
14 Medley            200  104.   285.</code></pre>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="more-on-grouping-structure" class="level1">
<h1><strong>More on Grouping Structure</strong></h1>
<p>We can now also consider ways to create column variables and a corresponding grouping structure within the <code>group_by()</code> verb.</p>
<section id="new-variable-columns" class="level2">
<h2 class="anchored" data-anchor-id="new-variable-columns"><strong>New Variable Columns</strong></h2>
<p><code>group_by()</code> is not designed to create new variables but rather create groups. The function, however, does not require variables in a data frame in order to group based on their levels or differences in values.</p>
<section id="group_by-using-a-function" class="level3">
<h3 class="anchored" data-anchor-id="group_by-using-a-function"><strong><code>group_by()</code> using a function</strong></h3>
<p>Heretofore, we have grouped by column variables in a data frame. But you can also group in other ways, for example, by a variable calculated by a function. For example, if you wanted to group by standard deviations, you could calculated the standard deviation <code>(Score-mean(Score)) / sd(Score)</code> for each student and then <code>cut()</code> that variable into groups. <code>cut</code> will take a numeric vector variable and turn it into a factor variable of <em>n</em> groups as determined by what you pass to <code>breaks</code>. There is also an argument to make the factor ordered if you wish, <code>ordered_result = TRUE</code> but the default behavior does not order the factor. You can also change the level labels if you inspect the function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">z_factor =</span> <span class="fu">cut</span>(<span class="at">x =</span> ((Score <span class="sc">-</span> <span class="fu">mean</span>(Score)) <span class="sc">/</span> <span class="fu">sd</span>(Score)), </span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">breaks =</span> <span class="dv">5</span>, </span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ordered_result =</span> <span class="cn">TRUE</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>                          )</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 5
# Groups:   z_factor [4]
   Student      Score School District z_factor       
   &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;ord&gt;          
 1 Jim             80 A      West     (0.194,0.781]  
 2 Sally           85 A      West     (0.781,1.37]   
 3 June            79 B      West     (0.194,0.781]  
 4 Mildred         80 B      West     (0.194,0.781]  
 5 Tilford         81 C      East     (0.194,0.781]  
 6 Beavis          91 C      East     (0.781,1.37]   
 7 Herman          89 C      East     (0.781,1.37]   
 8 Peppa           60 D      North    (-1.57,-0.979] 
 9 Kay             65 D      North    (-1.57,-0.979] 
10 Jake            67 E      North    (-0.979,-0.392]
11 Name Missing    65 E      North    (-1.57,-0.979] </code></pre>
</div>
</div>
<p>You can see that there are 4 different levels of the grouping variable. The tibble is grouped of course too.</p>
<p>If you struggle with remembering the formula for a z score, <code>scale()</code> will to the same thing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z =</span> (Score <span class="sc">-</span> <span class="fu">mean</span>(Score)) <span class="sc">/</span> <span class="fu">sd</span>(Score),</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">scale =</span> <span class="fu">scale</span>(Score)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Student Score School District          z      scale
1           Jim    80      A     West  0.3269018  0.3269018
2         Sally    85      A     West  0.8000492  0.8000492
3          June    79      B     West  0.2322724  0.2322724
4       Mildred    80      B     West  0.3269018  0.3269018
5       Tilford    81      C     East  0.4215313  0.4215313
6        Beavis    91      C     East  1.3678261  1.3678261
7        Herman    89      C     East  1.1785671  1.1785671
8         Peppa    60      D    North -1.5656877 -1.5656877
9           Kay    65      D    North -1.0925403 -1.0925403
10         Jake    67      E    North -0.9032814 -0.9032814
11 Name Missing    65      E    North -1.0925403 -1.0925403</code></pre>
</div>
</div>
<p>If you want <em>n</em> groups based on specific breaks, then pass a vector of those break units. For example, if we want levels to correspond to some meaningful standard-deviation cuts. For example, if you wanted to group those with z scores ranging from infinitely negative to -2, -2 to -1, - to 1, 1 to 2, and 2 to infinitely large, you could specify the breaks. If there are no values in those ranges, then there won’t be any data for those breaks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">z_factor =</span> <span class="fu">cut</span>(<span class="at">x =</span> <span class="fu">scale</span>(Score), </span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">Inf</span>),</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ordered_result =</span> <span class="cn">TRUE</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>                          ), </span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">|&gt;</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 5
   Student      Score School District z_factor
   &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;ord&gt;   
 1 Jim             80 A      West     (-1,1]  
 2 Sally           85 A      West     (-1,1]  
 3 June            79 B      West     (-1,1]  
 4 Mildred         80 B      West     (-1,1]  
 5 Tilford         81 C      East     (-1,1]  
 6 Beavis          91 C      East     (1,2]   
 7 Herman          89 C      East     (1,2]   
 8 Peppa           60 D      North    (-2,-1] 
 9 Kay             65 D      North    (-2,-1] 
10 Jake            67 E      North    (-1,1]  
11 Name Missing    65 E      North    (-2,-1] </code></pre>
</div>
</div>
<p>You can also just group by the function without using <code>cut()</code> if you wish to group by those with identical values on the variable. In this case, using <code>count()</code> or <code>tally()</code> reveals there are only two instances with the same score.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">z_factor =</span> ((Score <span class="sc">-</span> <span class="fu">mean</span>(Score)) <span class="sc">/</span> <span class="fu">sd</span>(Score))) <span class="sc">|&gt;</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">sort =</span> <span class="cn">TRUE</span>)     <span class="co"># tally(sort = TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 2
# Groups:   z_factor [9]
  z_factor     n
     &lt;dbl&gt; &lt;int&gt;
1   -1.09      2
2    0.327     2
3   -1.57      1
4   -0.903     1
5    0.232     1
6    0.422     1
7    0.800     1
8    1.18      1
9    1.37      1</code></pre>
</div>
</div>
</section>
</section>
<section id="adddrop-grouping-variable-columns" class="level2">
<h2 class="anchored" data-anchor-id="adddrop-grouping-variable-columns"><strong>Add/drop Grouping Variable Columns</strong></h2>
<p>By default, <code>group_by()</code> on a data frame that is already grouped (see earlier on grouped data frame), the existing grouping structure will be replaced by new grouping structure.</p>
<p>Let’s get an example. Please note that this example assigned the tibble to an object but whether you assign or not, the grouped structure exists. So functions that follow the <code>group_by()</code> keep that structure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>school_grouped <span class="ot">&lt;-</span> </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  DATA <span class="sc">|&gt;</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(School) </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>school_grouped</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 4
# Groups:   School [5]
   Student      Score School District
   &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;   
 1 Jim             80 A      West    
 2 Sally           85 A      West    
 3 June            79 B      West    
 4 Mildred         80 B      West    
 5 Tilford         81 C      East    
 6 Beavis          91 C      East    
 7 Herman          89 C      East    
 8 Peppa           60 D      North   
 9 Kay             65 D      North   
10 Jake            67 E      North   
11 Name Missing    65 E      North   </code></pre>
</div>
</div>
<p>Now group by a new column:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>school_grouped <span class="sc">|&gt;</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(District)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 4
# Groups:   District [3]
   Student      Score School District
   &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;   
 1 Jim             80 A      West    
 2 Sally           85 A      West    
 3 June            79 B      West    
 4 Mildred         80 B      West    
 5 Tilford         81 C      East    
 6 Beavis          91 C      East    
 7 Herman          89 C      East    
 8 Peppa           60 D      North   
 9 Kay             65 D      North   
10 Jake            67 E      North   
11 Name Missing    65 E      North   </code></pre>
</div>
</div>
<p>You will see the grouping structure has changed.</p>
<pre><code># A tibble: 11 × 4
# Groups:   District [3]</code></pre>
<section id="retain-grouping" class="level3">
<h3 class="anchored" data-anchor-id="retain-grouping"><strong>Retain Grouping</strong></h3>
<p>If you want to retain the existing group, you would need to use <code>.add = TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>school_grouped <span class="sc">|&gt;</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(District, <span class="at">.add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 4
# Groups:   School, District [5]
   Student      Score School District
   &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;   
 1 Jim             80 A      West    
 2 Sally           85 A      West    
 3 June            79 B      West    
 4 Mildred         80 B      West    
 5 Tilford         81 C      East    
 6 Beavis          91 C      East    
 7 Herman          89 C      East    
 8 Peppa           60 D      North   
 9 Kay             65 D      North   
10 Jake            67 E      North   
11 Name Missing    65 E      North   </code></pre>
</div>
</div>
<p>Notice in the console, that both <code>School</code> and <code>District</code> are included in the groups.</p>
<pre><code># A tibble: 11 × 4
# Groups:   School, District [5]</code></pre>
</section>
</section>
<section id="why-care-about-grouping-structure" class="level2">
<h2 class="anchored" data-anchor-id="why-care-about-grouping-structure"><strong>Why Care About Grouping Structure</strong></h2>
<p>Well, the functions you apply to a grouped tibble will sometimes lead to calculations that are not what you intend. We provided some examples earlier but given the importance of the issue, we may benefit from another example.</p>
<p>Let’s say you want to compute the average for each school and add that school average for each student. This would tell you how the student differs from their school performance. Then you want to obtain the mean of all the schools and see how the school differs from all the schools.</p>
<p>You code it out:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group </span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(School) <span class="sc">|&gt;</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the mean of Score for each School</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">School_Mean =</span> <span class="fu">mean</span>(Score)) <span class="sc">|&gt;</span>  </span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the mean of all values (think Grand Mean from stats)</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Mean_of_all =</span> <span class="fu">mean</span>(School_Mean)) <span class="sc">|&gt;</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the school performance relative to all</span></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">School_Performance =</span> <span class="fu">factor</span>(<span class="fu">case_when</span>(</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>    School_Mean <span class="sc">&lt;</span> Mean_of_all <span class="sc">~</span> <span class="st">"Below Average"</span>,</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>    School_Mean <span class="sc">==</span> Mean_of_all <span class="sc">~</span> <span class="st">"Average"</span>,</span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>    School_Mean <span class="sc">&gt;</span> Mean_of_all <span class="sc">~</span> <span class="st">"Above Average"</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 7
# Groups:   School [5]
   Student      Score School District School_Mean Mean_of_all School_Performance
   &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;          &lt;dbl&gt;       &lt;dbl&gt; &lt;ord&gt;             
 1 Jim             80 A      West            82.5        82.5 Average           
 2 Sally           85 A      West            82.5        82.5 Average           
 3 June            79 B      West            79.5        79.5 Average           
 4 Mildred         80 B      West            79.5        79.5 Average           
 5 Tilford         81 C      East            87          87   Average           
 6 Beavis          91 C      East            87          87   Average           
 7 Herman          89 C      East            87          87   Average           
 8 Peppa           60 D      North           62.5        62.5 Average           
 9 Kay             65 D      North           62.5        62.5 Average           
10 Jake            67 E      North           66          66   Average           
11 Name Missing    65 E      North           66          66   Average           </code></pre>
</div>
</div>
<p>Perfect. OK, let’s plot it. Oh but first let me inspect the data. Um, why is <code>School_Performance</code> the same for all <code>Students</code>? Schools are not performing the same so they cannot all be average. Check your <code>case_when()</code> for errors because that where the new variable was created. Then you spend 40 days and 40 nights trying to fix your code. No matter what you do with <code>case_when()</code>, you cannot fix the problem. So you try to create 42 data frames to solve your problem. Even grandma knows that is a ridiculous strategy. She suggests you read the documentation for all of the functions you used because one time her pot-luck cake flopped and she inspected the expiration date for all of her ingredients and found the baking soda was old.</p>
<p>You discover that the grouping structure is retained on all operations until that grouping structure is removed or replaced.</p>
</section>
</section>
<section id="ungroup" class="level1">
<h1><strong>ungroup()</strong></h1>
<p>Whereas summarize has a <code>.groups</code> functionality, <code>mutate()</code> does not. In order to have a simple data frame use follow <code>group_by()</code> and <code>mutate()</code> with <code>ungroup()</code>. But <code>ungroup()</code> can be used following both functions if that approach makes more sense to you.</p>
<p>Let’s add an <code>ungroup()</code> directly after performing the operation that needed the grouping structure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group </span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(School) <span class="sc">|&gt;</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the mean of Score for each School</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">School_Mean =</span> <span class="fu">mean</span>(Score)) <span class="sc">|&gt;</span>  </span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># break that grouping structure</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the mean of all values (think Grand Mean from stats)</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Mean_of_all =</span> <span class="fu">mean</span>(School_Mean)) <span class="sc">|&gt;</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the school performance relative to all</span></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">School_Performance =</span> <span class="fu">factor</span>(<span class="fu">case_when</span>(</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>    School_Mean <span class="sc">&lt;</span> Mean_of_all <span class="sc">~</span> <span class="st">"Below Average"</span>,</span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>    School_Mean <span class="sc">==</span> Mean_of_all <span class="sc">~</span> <span class="st">"Average"</span>,</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>    School_Mean <span class="sc">&gt;</span> Mean_of_all <span class="sc">~</span> <span class="st">"Above Average"</span></span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 7
   Student      Score School District School_Mean Mean_of_all School_Performance
   &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;          &lt;dbl&gt;       &lt;dbl&gt; &lt;ord&gt;             
 1 Jim             80 A      West            82.5        76.5 Above Average     
 2 Sally           85 A      West            82.5        76.5 Above Average     
 3 June            79 B      West            79.5        76.5 Above Average     
 4 Mildred         80 B      West            79.5        76.5 Above Average     
 5 Tilford         81 C      East            87          76.5 Above Average     
 6 Beavis          91 C      East            87          76.5 Above Average     
 7 Herman          89 C      East            87          76.5 Above Average     
 8 Peppa           60 D      North           62.5        76.5 Below Average     
 9 Kay             65 D      North           62.5        76.5 Below Average     
10 Jake            67 E      North           66          76.5 Below Average     
11 Name Missing    65 E      North           66          76.5 Below Average     </code></pre>
</div>
</div>
<p>Yes! <code>Mean_of_all</code> is now a true grand mean based on all of the data with no grouping at all. Comparing <code>Mean_of_all</code> to <code>School_Mean</code> provides two classifications.</p>
<section id="variable-loss-with-summarize" class="level2">
<h2 class="anchored" data-anchor-id="variable-loss-with-summarize"><strong>Variable loss with <code>summarize()</code></strong></h2>
<p>Because <code>summarize()</code> returns a tibble based on the grouping structure, you will lose all variables that are not in the grouping structure. By design, it no longer allows you to return a data frame with duplicated rows based on the variables passed to <code>group_by()</code>.</p>
<p>Returning to the school data, what this means, is that you cannot retain the <code>School</code> if you group by the <code>District</code> in order to obtain averages by district.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(District) <span class="sc">|&gt;</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(Score))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  District  Mean
  &lt;chr&gt;    &lt;dbl&gt;
1 East      87  
2 North     64.2
3 West      81  </code></pre>
</div>
</div>
<p>If you try to add <code>School</code> to <code>group_by()</code>, then you will only obtain the averages by schools within districts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(School, District) <span class="sc">|&gt;</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(Score)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'School'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
# Groups:   School [5]
  School District  Mean
  &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;
1 A      West      82.5
2 B      West      79.5
3 C      East      87  
4 D      North     62.5
5 E      North     66  </code></pre>
</div>
</div>
<p>You can try to summarize based on a variable without assign it to a function but that is no longer allowed with <code>summarize()</code>. The following code block will throw an error.</p>
<pre><code>DATA |&gt;
  group_by(District) |&gt;
  summarize(Mean = mean(Score),
          School               # add school 
          )</code></pre>
</section>
<section id="an-alternative-to-summarize-reframe" class="level2">
<h2 class="anchored" data-anchor-id="an-alternative-to-summarize-reframe"><strong>An alternative to <code>summarize()</code>: <code>reframe()</code></strong></h2>
<p>Instead, you can use <code>reframe()</code>, which allows for previous functionality of <code>summarize()</code> that is now deprecated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(District) <span class="sc">|&gt;</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(Score),</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>          School,</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>          Student</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>          )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 4
   District  Mean School Student     
   &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;       
 1 East      87   C      Tilford     
 2 East      87   C      Beavis      
 3 East      87   C      Herman      
 4 North     64.2 D      Peppa       
 5 North     64.2 D      Kay         
 6 North     64.2 E      Jake        
 7 North     64.2 E      Name Missing
 8 West      81   A      Jim         
 9 West      81   A      Sally       
10 West      81   B      June        
11 West      81   B      Mildred     </code></pre>
</div>
</div>
<p>Remember that the operations in <code>summarize()</code>, <code>mutate()</code>, and <code>reframe()</code> all depend on the grouping structure. If you wanted to add variables, you would need to group a different way and you would need to add all variables into <code>summarize()</code> every step of the way.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(District) <span class="sc">|&gt;</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">District_Mean =</span> <span class="fu">mean</span>(Score),</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>          School, </span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>          Student,</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>          Score</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">|&gt;</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(School) <span class="sc">|&gt;</span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">School_Mean =</span> <span class="fu">mean</span>(Score),</span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>          School, </span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>          Student,</span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>          Score,</span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a>          District_Mean</span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">|&gt;</span></span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 5
   School School_Mean Student      Score District_Mean
   &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;         &lt;dbl&gt;
 1 A             82.5 Jim             80          81  
 2 A             82.5 Sally           85          81  
 3 B             79.5 June            79          81  
 4 B             79.5 Mildred         80          81  
 5 C             87   Tilford         81          87  
 6 C             87   Beavis          91          87  
 7 C             87   Herman          89          87  
 8 D             62.5 Peppa           60          64.2
 9 D             62.5 Kay             65          64.2
10 E             66   Jake            67          64.2
11 E             66   Name Missing    65          64.2</code></pre>
</div>
</div>
</section>
<section id="retaining-distinct-data-after-mutate-using-distinct" class="level2">
<h2 class="anchored" data-anchor-id="retaining-distinct-data-after-mutate-using-distinct"><strong>Retaining distinct data after <code>mutate()</code> using distinct()`</strong></h2>
<p>This is just too tedious. Your better option is <code>mutate()</code> as all variables will be added to the full data frame. All variables are neatly and logically appended to the right hand side of the data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(District) <span class="sc">|&gt;</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">District_Mean =</span> <span class="fu">mean</span>(Score)) <span class="sc">|&gt;</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(School) <span class="sc">|&gt;</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">School_Mean =</span> <span class="fu">mean</span>(Score))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 6
# Groups:   School [5]
   Student      Score School District District_Mean School_Mean
   &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;
 1 Jim             80 A      West              81          82.5
 2 Sally           85 A      West              81          82.5
 3 June            79 B      West              81          79.5
 4 Mildred         80 B      West              81          79.5
 5 Tilford         81 C      East              87          87  
 6 Beavis          91 C      East              87          87  
 7 Herman          89 C      East              87          87  
 8 Peppa           60 D      North             64.2        62.5
 9 Kay             65 D      North             64.2        62.5
10 Jake            67 E      North             64.2        66  
11 Name Missing    65 E      North             64.2        66  </code></pre>
</div>
</div>
<p>Also, when you use a new <code>group_by()</code>, it will replace previous grouping structure by default. The following two code blocks return the same data frame.</p>
<pre><code>DATA |&gt;
  group_by(District) |&gt;
  mutate(District_Mean = mean(Score)) |&gt;
  group_by(School) |&gt;
  mutate(School_Mean = mean(Score))
  
DATA |&gt;
  group_by(District) |&gt;
  mutate(District_Mean = mean(Score)) |&gt;
  ungroup() |&gt;                   # ungroup
  group_by(School) |&gt;
  mutate(School_Mean = mean(Score))</code></pre>
<p>If you wish those variables to remain, you have a couple of options. The first would be to use <code>mutate()</code>.</p>
<p>Notice, however, that if you want to extract the summaries from the large data frame as you would have had you used <code>summarize()</code> , you cannot just <code>select()</code> your column of interest because the repetitions will exist for each row in the data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(District) <span class="sc">|&gt;</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">District_Mean =</span> <span class="fu">mean</span>(Score)) <span class="sc">|&gt;</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(School, District_Mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `District`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 3
# Groups:   District [3]
   District School District_Mean
   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
 1 West     A               81  
 2 West     A               81  
 3 West     B               81  
 4 West     B               81  
 5 East     C               87  
 6 East     C               87  
 7 East     C               87  
 8 North    D               64.2
 9 North    D               64.2
10 North    E               64.2
11 North    E               64.2</code></pre>
</div>
</div>
<p>You can obtain the rows that are <code>distinct()</code> (unique) and then <code>pick()</code> the ones to keep.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(District) <span class="sc">|&gt;</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">District_Mean =</span> <span class="fu">mean</span>(Score)) <span class="sc">|&gt;</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(<span class="fu">pick</span>(District, District_Mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
# Groups:   District [3]
  District District_Mean
  &lt;chr&gt;            &lt;dbl&gt;
1 West              81  
2 East              87  
3 North             64.2</code></pre>
</div>
</div>
<p>But you will need to <code>ungroup()</code> before <code>distinct()</code> because, as we have mentioned before, all subsequent functions other than <code>group_by()</code> will maintain the previous grouping structure by default.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="sc">|&gt;</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(School) <span class="sc">|&gt;</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">School_Mean =</span> <span class="fu">mean</span>(Score)) <span class="sc">|&gt;</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 5
   Student      Score School District School_Mean
   &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;          &lt;dbl&gt;
 1 Jim             80 A      West            82.5
 2 Sally           85 A      West            82.5
 3 June            79 B      West            79.5
 4 Mildred         80 B      West            79.5
 5 Tilford         81 C      East            87  
 6 Beavis          91 C      East            87  
 7 Herman          89 C      East            87  
 8 Peppa           60 D      North           62.5
 9 Kay             65 D      North           62.5
10 Jake            67 E      North           66  
11 Name Missing    65 E      North           66  </code></pre>
</div>
</div>
</section>
</section>
<section id="visualizing-data" class="level1">
<h1><strong>Visualizing Data</strong></h1>
<p>Visualizations of data aggregated differently will also convey information differently. The four variants of the data presented as bars communicate</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note: When you create <code>geom_bar()</code> or <code>geom_col()</code> plots, the bar <code>width</code> will change depending on the number of the bars in the plot. A legend position will also affect bar width. Thus, the four resulting visualizations will contain different bar widths even if set to the same value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>avg_plot <span class="ot">&lt;-</span> </span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  DATA <span class="sc">|&gt;</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Score =</span> <span class="fu">mean</span>(Score)) <span class="sc">|&gt;</span> </span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Average =</span> <span class="st">"Average"</span>) <span class="sc">|&gt;</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Average, Score)) <span class="sc">+</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">tag =</span> <span class="st">"A"</span>)</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>district_plot <span class="ot">&lt;-</span> </span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>  DATA <span class="sc">|&gt;</span></span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(District, Score)) <span class="sc">+</span></span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> .<span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">tag =</span> <span class="st">"B"</span>)</span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true" tabindex="-1"></a>school_plot <span class="ot">&lt;-</span> </span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true" tabindex="-1"></a>  DATA <span class="sc">|&gt;</span></span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(School, Score)) <span class="sc">+</span></span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> .<span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb127-23"><a href="#cb127-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">tag =</span> <span class="st">"C"</span>) </span>
<span id="cb127-24"><a href="#cb127-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-25"><a href="#cb127-25" aria-hidden="true" tabindex="-1"></a>school_district_plot <span class="ot">&lt;-</span> </span>
<span id="cb127-26"><a href="#cb127-26" aria-hidden="true" tabindex="-1"></a>  DATA <span class="sc">|&gt;</span></span>
<span id="cb127-27"><a href="#cb127-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(School, Score, <span class="at">col =</span> District)) <span class="sc">+</span></span>
<span id="cb127-28"><a href="#cb127-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> .<span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb127-29"><a href="#cb127-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb127-30"><a href="#cb127-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb127-31"><a href="#cb127-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">tag =</span> <span class="st">"D"</span>)  </span>
<span id="cb127-32"><a href="#cb127-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-33"><a href="#cb127-33" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(</span>
<span id="cb127-34"><a href="#cb127-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(gridExtra<span class="sc">::</span><span class="fu">arrangeGrob</span>(avg_plot, </span>
<span id="cb127-35"><a href="#cb127-35" aria-hidden="true" tabindex="-1"></a>                            district_plot, </span>
<span id="cb127-36"><a href="#cb127-36" aria-hidden="true" tabindex="-1"></a>                            school_plot, </span>
<span id="cb127-37"><a href="#cb127-37" aria-hidden="true" tabindex="-1"></a>                            school_district_plot, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb127-38"><a href="#cb127-38" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb127-39"><a href="#cb127-39" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="adding-data-summaries-to-plots" class="level1">
<h1><strong>Adding Data Summaries to Plots</strong></h1>
<p>But, let’s consider you don’t want to use color for your plot because the printing fees costs too much. Or perhaps, you are giving a talk to an audience of people who have achromatopsia. Whatever the reason, you need shapes. There are different ways to map shapes to variables. One way is with <code>aes(shape = variable)</code>. Just like with mapping <code>col</code> or <code>fill</code> to variables results in a palette assignment, a set of shapes are used by default as well. If you don’t like those shapes, you can pass a name vector to <code>scale_shape_manual(values = my_name_vector)</code>. Shapes, however, can also be mapped by variables as their <em>identity</em>. We have discussed identity values before. For shape, you need to find the shape values to assign a variable and then add a <code>scale_shape_identity()</code> layer.</p>
<p>For this example, we will add two new variables to the data frame and then map each to the full data and the group data, respectively.</p>
<p>First, let’s look at different shapes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">show_point_shapes</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for y is already present.
Adding another scale for y, which will replace the existing scale.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="a-single-data-frame-using-mutate" class="level1">
<h1><strong>A Single Data Frame using <code>mutate()</code></strong></h1>
<p>Let’s say that we want a plot that contains all of the data points jittered as well as the group means jittered so they don’t overlap. If we want one data frame to handle it, we will need to <code>mutate()</code> the group means following <code>group_by(Event, School)</code>. In the event that there happen to be exact or very similar means for the Schools, we will want to jitter the group means using <code>position = position_jitter(height = 0, width = .1)</code>.</p>
<p>Let’s see what happens. But to lead into another step, we will just assign a new data frame to <code>SWIM_NEW</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>SWIM_NEW <span class="ot">&lt;-</span> </span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>  SWIM <span class="sc">|&gt;</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Time <span class="sc">&lt;</span> <span class="dv">500</span>) <span class="sc">|&gt;</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">School =</span> <span class="fu">ifelse</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(School, <span class="st">"Clare"</span>), <span class="st">"CMS"</span>, <span class="st">"PP"</span>),</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Shape  =</span> <span class="fu">ifelse</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(School, <span class="st">"CMS"</span>), <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Shape2 =</span> <span class="fu">ifelse</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(School, <span class="st">"CMS"</span>), <span class="dv">21</span>, <span class="dv">24</span>),</span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group both (creates nxm subsets)</span></span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Event, School) <span class="sc">|&gt;</span> </span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(Time)) <span class="sc">|&gt;</span></span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then pass to <code>ggplot()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>full_identity_plot <span class="ot">&lt;-</span> </span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  SWIM_NEW <span class="sc">|&gt;</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Event)</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot all data (y = Time)</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> Time, </span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">shape =</span> Shape</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>                           ),</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">stroke =</span> <span class="fl">1.2</span>, <span class="co"># make a little thinker</span></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">4</span>,   <span class="co"># a little transparent</span></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">seed =</span> <span class="dv">167</span>, </span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">height =</span> <span class="dv">0</span>, </span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">width =</span> .<span class="dv">2</span>)</span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a layer using the grouped data (y = Mean)</span></span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> Mean, </span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a>                           <span class="at">shape =</span> Shape2   <span class="co"># filled </span></span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a>                           ), </span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">"grey50"</span>,   <span class="co"># fill color</span></span>
<span id="cb131-20"><a href="#cb131-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>,          <span class="co"># larger size</span></span>
<span id="cb131-21"><a href="#cb131-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="dv">1</span>,         <span class="co"># opaque</span></span>
<span id="cb131-22"><a href="#cb131-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">seed =</span> <span class="dv">167</span>, <span class="at">height =</span> <span class="dv">0</span>, <span class="at">width =</span> .<span class="dv">1</span>)</span>
<span id="cb131-23"><a href="#cb131-23" aria-hidden="true" tabindex="-1"></a>             ) <span class="sc">+</span></span>
<span id="cb131-24"><a href="#cb131-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb131-25"><a href="#cb131-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_identity</span>() <span class="sc">+</span>    <span class="co"># use the actual values in the mapped variable</span></span>
<span id="cb131-26"><a href="#cb131-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">"Caption illustration:</span><span class="sc">\n</span><span class="st">CMS (cicle),  PP (triangle); Mean (filled)"</span>)</span>
<span id="cb131-27"><a href="#cb131-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-28"><a href="#cb131-28" aria-hidden="true" tabindex="-1"></a>full_identity_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="the-jitter-problem-with-full-data-frame" class="level2">
<h2 class="anchored" data-anchor-id="the-jitter-problem-with-full-data-frame"><strong>The Jitter problem with full data frame</strong></h2>
<p>Jittering takes place at the row level. Because the full data frame is used, each row plotted gets jitter. This means that the group mean that is on each row (redundant per group) is plotted. In such cases, you might be better off using one data frame for the full plot and a summarized data frame for the other plot. You can define the data frame in <code>ggplot()</code> or in the specific <code>geom_point()</code>. In this example, we will define it in <code>ggplot()</code> along with aesthetics. This will be inherited by default for the first <code>geom_point()</code> and then we can specify for the second <code>geom_point()</code>.</p>
<p>Because there are different data frames, <code>Time</code> can be used in both data sets. There is no need to have two different variables as there is for the full data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>SWIMMEAN <span class="ot">&lt;-</span> </span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  SWIM_NEW <span class="sc">|&gt;</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group both (creates nxm subsets)</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Event, School) <span class="sc">|&gt;</span> </span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Time =</span> <span class="fu">mean</span>(Time)) <span class="sc">|&gt;</span></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and we need to add a shape too</span></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Shape =</span> <span class="fu">ifelse</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(</span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">string =</span> <span class="fu">tolower</span>(School), <span class="at">pattern =</span> <span class="st">"cms"</span>), </span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">21</span>, <span class="dv">24</span>)) <span class="co"># filled</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Event'. You can override using the
`.groups` argument.</code></pre>
</div>
</div>
<p>Notice that this data frame contains only four variables: <code>Event</code>, <code>School</code>, <code>Time</code>, and <code>Shape</code>. All aesthetics for a plot using that data set will be constrained to those variables. Because both data frames contain them, we can just add the aesthetics to the plot object rather than the geom.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>subset_identity_plot <span class="ot">&lt;-</span> </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  SWIM_NEW <span class="sc">|&gt;</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Event,</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> Time, </span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">shape =</span> Shape</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot all data (y = Time) from SWIM</span></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">seed =</span> <span class="dv">167</span>, </span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">height =</span> <span class="dv">0</span>, </span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">width =</span> .<span class="dv">2</span>),</span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">8</span>,</span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span></span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a layer using the grouped data (y = Time) from SWIMMEAN</span></span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> SWIMMEAN,</span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">"grey60"</span>,</span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">stroke =</span> <span class="dv">1</span>,</span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">seed =</span> <span class="dv">167</span>, <span class="at">height =</span> <span class="dv">0</span>, <span class="at">width =</span> .<span class="dv">3</span>)</span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a>             ) <span class="sc">+</span></span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_identity</span>() <span class="sc">+</span></span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">"Caption illustration:</span><span class="sc">\n</span><span class="st">CMS (cicle),  PP (triangle); Mean (filled)"</span>)</span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a>subset_identity_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Both plots together:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gridExtra<span class="sc">::</span><span class="fu">arrangeGrob</span>(full_identity_plot, subset_identity_plot, <span class="at">ncol =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>What you see in the second plot is what you might expect. Remember, that if you want to pass a grouping variable summary as an additional layer of a plot, you might be better off creating a separate data frame and pass it separately.</p>
</section>
<section id="examples-of-color-versions" class="level2">
<h2 class="anchored" data-anchor-id="examples-of-color-versions"><strong>Examples of Color Versions</strong></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>color_plot1 <span class="ot">&lt;-</span> </span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>  SWIM_NEW <span class="sc">|&gt;</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group both (creates nxm subsets)</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Event, School) <span class="sc">|&gt;</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MeanTime =</span> <span class="fu">mean</span>(Time)) <span class="sc">|&gt;</span></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Event, </span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> Time, </span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">col =</span> School, </span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> School</span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot all data (y = Time)</span></span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">seed =</span> <span class="dv">167</span>, </span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">height =</span> <span class="dv">0</span>, </span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">width =</span> .<span class="dv">2</span>),</span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">pch =</span> <span class="dv">1</span>,</span>
<span id="cb136-18"><a href="#cb136-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">7</span>,</span>
<span id="cb136-19"><a href="#cb136-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">stroke =</span> <span class="dv">1</span>,</span>
<span id="cb136-20"><a href="#cb136-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span></span>
<span id="cb136-21"><a href="#cb136-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb136-22"><a href="#cb136-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a layer using the grouped data (y = MeanTime)</span></span>
<span id="cb136-23"><a href="#cb136-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> MeanTime), </span>
<span id="cb136-24"><a href="#cb136-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb136-25"><a href="#cb136-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">4</span></span>
<span id="cb136-26"><a href="#cb136-26" aria-hidden="true" tabindex="-1"></a>             ) <span class="sc">+</span></span>
<span id="cb136-27"><a href="#cb136-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb136-28"><a href="#cb136-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">"Caption illustration:</span><span class="sc">\n</span><span class="st">Means are closed circles"</span>)</span>
<span id="cb136-29"><a href="#cb136-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-30"><a href="#cb136-30" aria-hidden="true" tabindex="-1"></a>color_plot2 <span class="ot">&lt;-</span> </span>
<span id="cb136-31"><a href="#cb136-31" aria-hidden="true" tabindex="-1"></a>  SWIM_NEW <span class="sc">|&gt;</span></span>
<span id="cb136-32"><a href="#cb136-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group both (creates nxm subsets)</span></span>
<span id="cb136-33"><a href="#cb136-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Event, School) <span class="sc">|&gt;</span> </span>
<span id="cb136-34"><a href="#cb136-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MeanTime =</span> <span class="fu">mean</span>(Time)) <span class="sc">|&gt;</span></span>
<span id="cb136-35"><a href="#cb136-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb136-36"><a href="#cb136-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Event, </span>
<span id="cb136-37"><a href="#cb136-37" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> Time, </span>
<span id="cb136-38"><a href="#cb136-38" aria-hidden="true" tabindex="-1"></a>                <span class="at">col =</span> School, </span>
<span id="cb136-39"><a href="#cb136-39" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> School</span>
<span id="cb136-40"><a href="#cb136-40" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb136-41"><a href="#cb136-41" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span></span>
<span id="cb136-42"><a href="#cb136-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot all data (y = Time)</span></span>
<span id="cb136-43"><a href="#cb136-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">seed =</span> <span class="dv">167</span>, </span>
<span id="cb136-44"><a href="#cb136-44" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">height =</span> <span class="dv">0</span>, </span>
<span id="cb136-45"><a href="#cb136-45" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">width =</span> .<span class="dv">2</span>),</span>
<span id="cb136-46"><a href="#cb136-46" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">7</span>,</span>
<span id="cb136-47"><a href="#cb136-47" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span></span>
<span id="cb136-48"><a href="#cb136-48" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb136-49"><a href="#cb136-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a layer using the grouped data (y = MeanTime)</span></span>
<span id="cb136-50"><a href="#cb136-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> MeanTime), </span>
<span id="cb136-51"><a href="#cb136-51" aria-hidden="true" tabindex="-1"></a>             <span class="at">pch =</span> <span class="dv">1</span>,</span>
<span id="cb136-52"><a href="#cb136-52" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb136-53"><a href="#cb136-53" aria-hidden="true" tabindex="-1"></a>             <span class="at">stroke =</span> <span class="dv">1</span>,</span>
<span id="cb136-54"><a href="#cb136-54" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">4</span></span>
<span id="cb136-55"><a href="#cb136-55" aria-hidden="true" tabindex="-1"></a>             ) <span class="sc">+</span></span>
<span id="cb136-56"><a href="#cb136-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb136-57"><a href="#cb136-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">"Caption illustration:</span><span class="sc">\n</span><span class="st">Means are open circles"</span>)</span>
<span id="cb136-58"><a href="#cb136-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-59"><a href="#cb136-59" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gridExtra<span class="sc">::</span><span class="fu">arrangeGrob</span>(color_plot1, color_plot2, <span class="at">ncol =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="a-note-on-the-size-aesthetic" class="level2">
<h2 class="anchored" data-anchor-id="a-note-on-the-size-aesthetic"><strong>A note on the <code>size</code> aesthetic</strong></h2>
<p>For <code>geom_point()</code>, you should understand what is happening when you pass an argument (e.g., <code>size = 2</code>) to the parameter because of its implications for bias in data visualizations. The size parameter scales on both the x and y dimensions proportionately which means that for any circle that doubles the size of the point, its radius will also double. When the radius doubles, however, the diameter and circumference also double. You might guess where this discussion is going.</p>
<p>If size is a constant, this likely will not be a problem. If, however, size is mapped to a variable, then then you have a perceptual challenge related to difficulty with comparing area. See <a href="https://www.tandfonline.com/doi/abs/10.1080/01621459.1984.10478080">Cleveland &amp; McGill (1984)</a>. Moreover, because the area of a circle is proportional to the square of its radius, doubling the point size increases area fourfold.</p>
<!--
The area \( A \) of a circle is given by the formula:

$$
A = \pi r^2
$$

If the radius is doubled (from \( r \) to \( 2r \)), the new area \( A' \) is calculated as follows:

$$
A' = \pi (2r)^2 = \pi (4r^2) = 4\pi r^2
$$

This shows that the new area is *four* times the original area:

$$
A' = 4A
$$

-->
<p>Here is an example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> </span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">0</span>, </span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">panel =</span> <span class="fu">c</span>(<span class="st">"`size = 13`"</span>, <span class="st">"`size = 26`"</span>), </span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">size =</span> <span class="fu">c</span>(<span class="dv">13</span>, <span class="dv">26</span>)),</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(x, y, <span class="at">size =</span> size)</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">+</span> </span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>),</span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>),</span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_identity</span>() <span class="sc">+</span></span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(. <span class="sc">~</span> panel) <span class="sc">+</span> </span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="statistical_transformations_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="summary" class="level1">
<h1><strong>Summary</strong></h1>
<p>How data are aggregated will affect both summary statistics and data visualizations. With each level of aggregation, fine-grained or case-level data are lost and not available for plotting. That fine-grained detail may be computed with measures like variability and confidence levels but those measures are summaries themselves. Including them is not the same as including all data. That said, including all data may influence visual attention and interpretation of plots to the extent that outlying points or grouping characteristics (point proximity) drive attention to physical locations of plots at the cost of attending to other locations.</p>
<p>A main workhorse of adding variables and creating aggregated data in the <code>R</code> language is the <strong>{dplyr}</strong> library. You must, however, be sensitive to the way its functions work so that the variables you create in either a full or summarized data frame represent your intentions and goals.</p>
<p>We have seen that a lot of customization can be applied to our visualizations of data and have shown just a little bit of what can be done. Many more functions and parameters can be used to customize to greater extents.</p>
</section>
<section id="session-info" class="level1">
<h1><strong>Session Info</strong></h1>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.4.1 (2024-06-14 ucrt)
Platform: x86_64-w64-mingw32/x64
Running under: Windows 11 x64 (build 22631)

Matrix products: default


locale:
[1] LC_COLLATE=English_United States.utf8 
[2] LC_CTYPE=English_United States.utf8   
[3] LC_MONETARY=English_United States.utf8
[4] LC_NUMERIC=C                          
[5] LC_TIME=English_United States.utf8    

time zone: America/Los_Angeles
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] htmltools_0.5.8.1 DT_0.33           vroom_1.6.5       lubridate_1.9.3  
 [5] forcats_1.0.0     stringr_1.5.1     dplyr_1.1.4       purrr_1.0.2      
 [9] readr_2.1.5       tidyr_1.3.1       tibble_3.2.1      ggplot2_3.5.1    
[13] tidyverse_2.0.0  

loaded via a namespace (and not attached):
 [1] gtable_0.3.5      xfun_0.45         htmlwidgets_1.6.4 rstatix_0.7.2    
 [5] tzdb_0.4.0        vctrs_0.6.5       tools_4.4.1       generics_0.1.3   
 [9] fansi_1.0.6       cluster_2.1.6     pkgconfig_2.0.3   R.oo_1.26.0      
[13] data.table_1.15.4 checkmate_2.3.1   lifecycle_1.0.4   compiler_4.4.1   
[17] farver_2.1.2      munsell_0.5.1     carData_3.0-5     yaml_2.3.10      
[21] htmlTable_2.4.2   Formula_1.2-5     car_3.1-2         pillar_1.9.0     
[25] ggpubr_0.6.0      crayon_1.5.3      R.utils_2.12.3    Hmisc_5.1-3      
[29] abind_1.4-5       rpart_4.1.23      tidyselect_1.2.1  digest_0.6.36    
[33] stringi_1.8.4     labeling_0.4.3    rprojroot_2.0.4   fastmap_1.2.0    
[37] grid_4.4.1        here_1.0.1        colorspace_2.1-0  cli_3.6.3        
[41] magrittr_2.0.3    base64enc_0.1-3   utf8_1.2.4        broom_1.0.6      
[45] foreign_0.8-87    withr_3.0.1       scales_1.3.0      backports_1.5.0  
[49] bit64_4.0.5       timechange_0.3.0  rmarkdown_2.27    bit_4.0.5        
[53] nnet_7.3-19       gridExtra_2.3     ggsignif_0.6.4    R.methodsS3_1.8.2
[57] hms_1.1.3         evaluate_0.24.0   knitr_1.47        rlang_1.1.4      
[61] glue_1.7.0        rstudioapi_0.16.0 jsonlite_1.8.8    R6_2.5.1         </code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/gabrielcook\.xyz\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>