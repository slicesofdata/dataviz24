---
title: "Homework 06: Instructions"
#author: "yourname"
#date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  pdf_document:
    toc: false
  html_document:
    toc: false
    number_sections: true
    code_folding: show
  word_document:
    toc: true
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
eval_answers = TRUE
include_answers = FALSE
R.utils::sourceDirectory(here::here("r", "functions"))
```

```{r, eval=eval_answers, include=include_answers}
#At this point in the course, you have a version of a raw data file. You have scripts to clean it, subset it for a project sub-goal, convert it from wide to long, and clean the long file. The next step involved getting a better idea of what's going on in the data. 
#
#You will work with a larger data file now: `"champ_all_waves_first_twenty_schools.Rds"`. This file, however, still does not include all of the data. Distribution of that last data file will involve a test of your code that all of your scripts work as whole. 
```


```{r eval=eval_answers, message=FALSE, warning=FALSE, include=include_answers}
library(tidyverse)
```


```{r, eval=eval_answers, include=include_answers}
GNG_CLEAN <- readRDS(here::here("data", "gng", "gng_long_cleaned.Rds"))

GNG_CLEAN |> view_html()
```


```{r, eval=eval_answers, include=include_answers}
SSPAN_CLEAN <- readRDS(here::here("data", "symmspan", "sspan_long_clean.Rds"))
#LONG_SPAN |>  view_html()
```

# **Summarizing Data**

```{r, eval=eval_answers, include=include_answers}
std_error <- function(x) { sd(na.omit(x)) / sqrt(length(na.omit(x))) }

# Custom function to calculate minimum with NA handling
min_with_NA_check <- function(x) {
  if (any(!is.na(x))) {
    return(min(x, na.rm = TRUE))
  } else {
    return(NA)  # Return NA if all values are NA
  }
}

# Custom function to calculate maximum with NA handling
max_with_NA_check <- function(x) {
  if (any(!is.na(x))) {
    return(max(x, na.rm = TRUE))
  } else {
    return(NA)  # Return NA if all values are NA
  }
}

summarize_across <- list(
    mean   = ~mean(na.omit(.x)),
    median = ~median(na.omit(.x)),
    min    = ~max_with_NA_check(.x),
    max    = ~max_with_NA_check(.x),
    sd     = ~sd(na.omit(.x)),
    n      = ~length(na.omit(.x)),
    sem    = ~std_error(.x)
    )
```


1. Using either the `gng_long.Rds` or the `gng_long_cleaned.Rds` data files (your own or one I shared with you), determine how many go and no-go trials there are for each individual at each wave. Answer should take the following form. If there are elements in the data that do not make sense, you should add that comment to your answer and make a note of the issue for your cleaning.

```
  id_subject  wave target total_trials
  <chr>      <dbl> <chr>         <dbl>
1 FAQAAW         1 Go               ?
2 FAQAAW         1 No-Go            ?
3 FAQAAW         2 Go               ?
4 FAQAAW         2 No-Go            ?
5 FAQAAW         3 Go               ?
6 FAQAAW         3 No-Go            ?
```

```{r, eval=eval_answers, include=include_answers}
GNG_CLEAN |>
  select(c(id_subject, wave, w1age, target, 
           count, accuracy, rt, missing_trials)) |>
  group_by(id_subject, wave, target) |>
  #mutate(total_trials = sum(count))
  select(!c("count", "missing_trials"))
```


2. Take the following `list()` and edit it so that your summary table will include the mean, median, and standard deviation. Make sure your functions can handle `NA` values.

```{.r}
summarize_across <- list(
    mean = ~mean(.x, na.rm = TRUE) # or mean(na.omit(.x))
    )
```

**Choose One**

3a. Using the `gng_long_cleaned.Rds` data, aggregate your data by participant, wave, and trial type (e.g, go vs. no-go trials). Then generate a summary data frame containing the mean, median, and standard deviation across `accuracy` and `rt` so that you have the summary statistics for each participant, at each wave, and for both go and no-go trials. Remove the grouping structure so that if you assign it to an object or write the data frame, it is not grouped.

```{r, eval=eval_answers, include=include_answers}
the_vars <- c("accuracy", "rt") 
#GNG_CLEAN |> view_html()

GNG_CLEAN |>
  select(c(id_subject, wave, target, accuracy, rt)) |>
  group_by(id_subject, wave, target) |>
  summarise(across(.cols = the_vars,  
                   .fns = summarize_across[c(1, 2, 5)],
                   .names = "{.col}_{.fn}"
                   )
            ) |>
  ungroup() |>
  view_html()
```



```{r, eval=eval_answers, include=include_answers}
#2. Using the same data, now that your data are aggregated at the participant level, aggregate across all participants for overall group data by wave and trial type (e.g, go vs. no-go trials) to generate a summary data frame containing the mean, median, and standard deviation across `accuracy` and `rt` so that you have the group-level summary statistics (over all participants), at each wave, and for both go and no-go trial. 
GNG_CLEAN |>
  select(c(id_subject, wave, w1age, target, accuracy, rt)) |>
  group_by(id_subject, wave, target) |>
  summarise(across(.cols = c("rt", "accuracy"),  
                   .fns = summarize_across[c(1, 2, 5)],
                   .names = "{.col}_{.fn}"
                   )
            ) |>
  group_by(wave, target) |>
  summarise(across(.cols = c("rt_mean", "accuracy_mean"),  
                   .fns = summarize_across[c(1, 2, 5)],
                   .names = "{.col}_{.fn}"
                   )
            ) |>
  ungroup() |>
  view_html()
```



3b. Using the `sspan_long_cleaned.Rds` data, generate a summary data frame containing the mean, median, and standard deviation across `sspan` and `totalcorrectsquares` by wave. 

```{r, eval=eval_answers, include=include_answers}
the_vars <- c("sspan", "totalcorrectsquares") 
#SSPAN_CLEAN |> view_html()

SSPAN_CLEAN |>
  filter(!is.na(correct)) |>
  select(c(id_subject, wave, the_vars)) |>
  group_by(wave) |>
  summarise(across(.cols = the_vars,  
                   .fns = summarize_across[c(1, 2, 5)],
                   .names = "{.col}_{.fn}"
                   ), 
            .groups = "drop"
            ) |>
  ungroup() |>
  view_html()
```


4. Summarize your data set in a different way.
